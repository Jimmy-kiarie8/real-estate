import{B as We,i as oe,o as Ee,c as _e,w as U,b as z,f as ee,t as Me,e as Oe,a as Le}from"./app-1d1cfcf2.js";import qe from"./edit-3ec8e19d.js";import{_ as He}from"./_plugin-vue_export-helper-c27b6911.js";import"./FormComponent-c569025e.js";var Ne={exports:{}};(function(A,Z){(function(j,Y){A.exports=Y()})(window,function(){return function(j){var Y={};function _(u){if(Y[u])return Y[u].exports;var n=Y[u]={i:u,l:!1,exports:{}};return j[u].call(n.exports,n,n.exports,_),n.l=!0,n.exports}return _.m=j,_.c=Y,_.d=function(u,n,o){_.o(u,n)||Object.defineProperty(u,n,{enumerable:!0,get:o})},_.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},_.t=function(u,n){if(1&n&&(u=_(u)),8&n||4&n&&typeof u=="object"&&u&&u.__esModule)return u;var o=Object.create(null);if(_.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:u}),2&n&&typeof u!="string")for(var e in u)_.d(o,e,(function(c){return u[c]}).bind(null,e));return o},_.n=function(u){var n=u&&u.__esModule?function(){return u.default}:function(){return u};return _.d(n,"a",n),n},_.o=function(u,n){return Object.prototype.hasOwnProperty.call(u,n)},_.p="",_(_.s=3)}([function(j,Y,_){(function(u){var n=_(6);j.exports=n({window:u.window})}).call(this,_(5))},function(j,Y,_){var u=!0,n=!0;function o(e,c,d){var r=e.match(c);return r&&r.length>=d&&parseInt(r[d],10)}j.exports={extractVersion:o,wrapPeerConnectionEvent:function(e,c,d){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,g=r.addEventListener;r.addEventListener=function(v,s){if(v!==c)return g.apply(this,arguments);var f=function(t){var i=d(t);i&&s(i)};return this._eventMap=this._eventMap||{},this._eventMap[s]=f,g.apply(this,[v,f])};var h=r.removeEventListener;r.removeEventListener=function(v,s){if(v!==c||!this._eventMap||!this._eventMap[s])return h.apply(this,arguments);var f=this._eventMap[s];return delete this._eventMap[s],h.apply(this,[v,f])},Object.defineProperty(r,"on"+c,{get:function(){return this["_on"+c]},set:function(v){this["_on"+c]&&(this.removeEventListener(c,this["_on"+c]),delete this["_on"+c]),v&&this.addEventListener(c,this["_on"+c]=v)},enumerable:!0,configurable:!0})}},disableLog:function(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(u=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if(typeof window=="object"){if(u)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}},deprecated:function(e,c){n&&console.warn(e+" is deprecated, please use "+c+" instead.")},detectBrowser:function(e){var c=e&&e.navigator,d={browser:null,version:null};if(e===void 0||!e.navigator)return d.browser="Not a browser.",d;if(c.mozGetUserMedia)d.browser="firefox",d.version=o(c.userAgent,/Firefox\/(\d+)\./,1);else if(c.webkitGetUserMedia)d.browser="chrome",d.version=o(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(c.mediaDevices&&c.userAgent.match(/Edge\/(\d+).(\d+)$/))d.browser="edge",d.version=o(c.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!c.userAgent.match(/AppleWebKit\/(\d+)\./))return d.browser="Not a supported browser.",d;d.browser="safari",d.version=o(c.userAgent,/AppleWebKit\/(\d+)\./,1)}return d}}},function(j,Y,_){var u={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};u.localCName=u.generateIdentifier(),u.splitLines=function(n){return n.trim().split(`
`).map(function(o){return o.trim()})},u.splitSections=function(n){return n.split(`
m=`).map(function(o,e){return(e>0?"m="+o:o).trim()+`\r
`})},u.getDescription=function(n){var o=u.splitSections(n);return o&&o[0]},u.getMediaSections=function(n){var o=u.splitSections(n);return o.shift(),o},u.matchPrefix=function(n,o){return u.splitLines(n).filter(function(e){return e.indexOf(o)===0})},u.parseCandidate=function(n){for(var o,e={foundation:(o=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" "))[0],component:parseInt(o[1],10),protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]},c=8;c<o.length;c+=2)switch(o[c]){case"raddr":e.relatedAddress=o[c+1];break;case"rport":e.relatedPort=parseInt(o[c+1],10);break;case"tcptype":e.tcpType=o[c+1];break;case"ufrag":e.ufrag=o[c+1],e.usernameFragment=o[c+1];break;default:e[o[c]]=o[c+1]}return e},u.writeCandidate=function(n){var o=[];o.push(n.foundation),o.push(n.component),o.push(n.protocol.toUpperCase()),o.push(n.priority),o.push(n.address||n.ip),o.push(n.port);var e=n.type;return o.push("typ"),o.push(e),e!=="host"&&n.relatedAddress&&n.relatedPort&&(o.push("raddr"),o.push(n.relatedAddress),o.push("rport"),o.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(o.push("ufrag"),o.push(n.usernameFragment||n.ufrag)),"candidate:"+o.join(" ")},u.parseIceOptions=function(n){return n.substr(14).split(" ")},u.parseRtpMap=function(n){var o=n.substr(9).split(" "),e={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),e.name=o[0],e.clockRate=parseInt(o[1],10),e.channels=o.length===3?parseInt(o[2],10):1,e.numChannels=e.channels,e},u.writeRtpMap=function(n){var o=n.payloadType;n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType);var e=n.channels||n.numChannels||1;return"a=rtpmap:"+o+" "+n.name+"/"+n.clockRate+(e!==1?"/"+e:"")+`\r
`},u.parseExtmap=function(n){var o=n.substr(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1]}},u.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+`\r
`},u.parseFmtp=function(n){for(var o,e={},c=n.substr(n.indexOf(" ")+1).split(";"),d=0;d<c.length;d++)e[(o=c[d].trim().split("="))[0].trim()]=o[1];return e},u.writeFmtp=function(n){var o="",e=n.payloadType;if(n.preferredPayloadType!==void 0&&(e=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){var c=[];Object.keys(n.parameters).forEach(function(d){n.parameters[d]?c.push(d+"="+n.parameters[d]):c.push(d)}),o+="a=fmtp:"+e+" "+c.join(";")+`\r
`}return o},u.parseRtcpFb=function(n){var o=n.substr(n.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},u.writeRtcpFb=function(n){var o="",e=n.payloadType;return n.preferredPayloadType!==void 0&&(e=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(function(c){o+="a=rtcp-fb:"+e+" "+c.type+(c.parameter&&c.parameter.length?" "+c.parameter:"")+`\r
`}),o},u.parseSsrcMedia=function(n){var o=n.indexOf(" "),e={ssrc:parseInt(n.substr(7,o-7),10)},c=n.indexOf(":",o);return c>-1?(e.attribute=n.substr(o+1,c-o-1),e.value=n.substr(c+1)):e.attribute=n.substr(o+1),e},u.parseSsrcGroup=function(n){var o=n.substr(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(function(e){return parseInt(e,10)})}},u.getMid=function(n){var o=u.matchPrefix(n,"a=mid:")[0];if(o)return o.substr(6)},u.parseFingerprint=function(n){var o=n.substr(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1]}},u.getDtlsParameters=function(n,o){return{role:"auto",fingerprints:u.matchPrefix(n+o,"a=fingerprint:").map(u.parseFingerprint)}},u.writeDtlsParameters=function(n,o){var e="a=setup:"+o+`\r
`;return n.fingerprints.forEach(function(c){e+="a=fingerprint:"+c.algorithm+" "+c.value+`\r
`}),e},u.getIceParameters=function(n,o){var e=u.splitLines(n);return{usernameFragment:(e=e.concat(u.splitLines(o))).filter(function(c){return c.indexOf("a=ice-ufrag:")===0})[0].substr(12),password:e.filter(function(c){return c.indexOf("a=ice-pwd:")===0})[0].substr(10)}},u.writeIceParameters=function(n){return"a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`},u.parseRtpParameters=function(n){for(var o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},e=u.splitLines(n)[0].split(" "),c=3;c<e.length;c++){var d=e[c],r=u.matchPrefix(n,"a=rtpmap:"+d+" ")[0];if(r){var g=u.parseRtpMap(r),h=u.matchPrefix(n,"a=fmtp:"+d+" ");switch(g.parameters=h.length?u.parseFmtp(h[0]):{},g.rtcpFeedback=u.matchPrefix(n,"a=rtcp-fb:"+d+" ").map(u.parseRtcpFb),o.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(g.name.toUpperCase())}}}return u.matchPrefix(n,"a=extmap:").forEach(function(v){o.headerExtensions.push(u.parseExtmap(v))}),o},u.writeRtpDescription=function(n,o){var e="";e+="m="+n+" ",e+=o.codecs.length>0?"9":"0",e+=" UDP/TLS/RTP/SAVPF ",e+=o.codecs.map(function(d){return d.preferredPayloadType!==void 0?d.preferredPayloadType:d.payloadType}).join(" ")+`\r
`,e+=`c=IN IP4 0.0.0.0\r
`,e+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(function(d){e+=u.writeRtpMap(d),e+=u.writeFmtp(d),e+=u.writeRtcpFb(d)});var c=0;return o.codecs.forEach(function(d){d.maxptime>c&&(c=d.maxptime)}),c>0&&(e+="a=maxptime:"+c+`\r
`),e+=`a=rtcp-mux\r
`,o.headerExtensions&&o.headerExtensions.forEach(function(d){e+=u.writeExtmap(d)}),e},u.parseRtpEncodingParameters=function(n){var o,e=[],c=u.parseRtpParameters(n),d=c.fecMechanisms.indexOf("RED")!==-1,r=c.fecMechanisms.indexOf("ULPFEC")!==-1,g=u.matchPrefix(n,"a=ssrc:").map(function(f){return u.parseSsrcMedia(f)}).filter(function(f){return f.attribute==="cname"}),h=g.length>0&&g[0].ssrc,v=u.matchPrefix(n,"a=ssrc-group:FID").map(function(f){return f.substr(17).split(" ").map(function(t){return parseInt(t,10)})});v.length>0&&v[0].length>1&&v[0][0]===h&&(o=v[0][1]),c.codecs.forEach(function(f){if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){var t={ssrc:h,codecPayloadType:parseInt(f.parameters.apt,10)};h&&o&&(t.rtx={ssrc:o}),e.push(t),d&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:h,mechanism:r?"red+ulpfec":"red"},e.push(t))}}),e.length===0&&h&&e.push({ssrc:h});var s=u.matchPrefix(n,"b=");return s.length&&(s=s[0].indexOf("b=TIAS:")===0?parseInt(s[0].substr(7),10):s[0].indexOf("b=AS:")===0?1e3*parseInt(s[0].substr(5),10)*.95-16e3:void 0,e.forEach(function(f){f.maxBitrate=s})),e},u.parseRtcpParameters=function(n){var o={},e=u.matchPrefix(n,"a=ssrc:").map(function(r){return u.parseSsrcMedia(r)}).filter(function(r){return r.attribute==="cname"})[0];e&&(o.cname=e.value,o.ssrc=e.ssrc);var c=u.matchPrefix(n,"a=rtcp-rsize");o.reducedSize=c.length>0,o.compound=c.length===0;var d=u.matchPrefix(n,"a=rtcp-mux");return o.mux=d.length>0,o},u.parseMsid=function(n){var o,e=u.matchPrefix(n,"a=msid:");if(e.length===1)return{stream:(o=e[0].substr(7).split(" "))[0],track:o[1]};var c=u.matchPrefix(n,"a=ssrc:").map(function(d){return u.parseSsrcMedia(d)}).filter(function(d){return d.attribute==="msid"});return c.length>0?{stream:(o=c[0].value.split(" "))[0],track:o[1]}:void 0},u.generateSessionId=function(){return Math.random().toString().substr(2,21)},u.writeSessionBoilerplate=function(n,o,e){var c=o!==void 0?o:2;return`v=0\r
o=`+(e||"thisisadapterortc")+" "+(n||u.generateSessionId())+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},u.writeMediaSection=function(n,o,e,c){var d=u.writeRtpDescription(n.kind,o);if(d+=u.writeIceParameters(n.iceGatherer.getLocalParameters()),d+=u.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),e==="offer"?"actpass":"active"),d+="a=mid:"+n.mid+`\r
`,n.direction?d+="a="+n.direction+`\r
`:n.rtpSender&&n.rtpReceiver?d+=`a=sendrecv\r
`:n.rtpSender?d+=`a=sendonly\r
`:n.rtpReceiver?d+=`a=recvonly\r
`:d+=`a=inactive\r
`,n.rtpSender){var r="msid:"+c.id+" "+n.rtpSender.track.id+`\r
`;d+="a="+r,d+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+r,n.sendEncodingParameters[0].rtx&&(d+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+r,d+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return d+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+u.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(d+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+u.localCName+`\r
`),d},u.getDirection=function(n,o){for(var e=u.splitLines(n),c=0;c<e.length;c++)switch(e[c]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return e[c].substr(2)}return o?u.getDirection(o):"sendrecv"},u.getKind=function(n){return u.splitLines(n)[0].split(" ")[0].substr(2)},u.isRejected=function(n){return n.split(" ",2)[1]==="0"},u.parseMLine=function(n){var o=u.splitLines(n)[0].substr(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},u.parseOLine=function(n){var o=u.matchPrefix(n,"o=")[0].substr(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},u.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;for(var o=u.splitLines(n),e=0;e<o.length;e++)if(o[e].length<2||o[e].charAt(1)!=="=")return!1;return!0},j.exports=u},function(j,Y,_){_(4),j.exports=_(17)},function(j,Y,_){var u=function(n){var o=Object.prototype,e=o.hasOwnProperty,c=typeof Symbol=="function"?Symbol:{},d=c.iterator||"@@iterator",r=c.asyncIterator||"@@asyncIterator",g=c.toStringTag||"@@toStringTag";function h(k,w,M,F){var P=w&&w.prototype instanceof f?w:f,X=Object.create(P.prototype),se=new ne(F||[]);return X._invoke=function(pe,ae,I){var W="suspendedStart";return function(ue,q){if(W==="executing")throw new Error("Generator is already running");if(W==="completed"){if(ue==="throw")throw q;return B()}for(I.method=ue,I.arg=q;;){var ve=I.delegate;if(ve){var ge=O(ve,I);if(ge){if(ge===s)continue;return ge}}if(I.method==="next")I.sent=I._sent=I.arg;else if(I.method==="throw"){if(W==="suspendedStart")throw W="completed",I.arg;I.dispatchException(I.arg)}else I.method==="return"&&I.abrupt("return",I.arg);W="executing";var ce=v(pe,ae,I);if(ce.type==="normal"){if(W=I.done?"completed":"suspendedYield",ce.arg===s)continue;return{value:ce.arg,done:I.done}}ce.type==="throw"&&(W="completed",I.method="throw",I.arg=ce.arg)}}}(k,M,se),X}function v(k,w,M){try{return{type:"normal",arg:k.call(w,M)}}catch(F){return{type:"throw",arg:F}}}n.wrap=h;var s={};function f(){}function t(){}function i(){}var a={};a[d]=function(){return this};var p=Object.getPrototypeOf,y=p&&p(p(Q([])));y&&y!==o&&e.call(y,d)&&(a=y);var R=i.prototype=f.prototype=Object.create(a);function b(k){["next","throw","return"].forEach(function(w){k[w]=function(M){return this._invoke(w,M)}})}function E(k,w){var M;this._invoke=function(F,P){function X(){return new w(function(se,pe){(function ae(I,W,ue,q){var ve=v(k[I],k,W);if(ve.type!=="throw"){var ge=ve.arg,ce=ge.value;return ce&&typeof ce=="object"&&e.call(ce,"__await")?w.resolve(ce.__await).then(function(fe){ae("next",fe,ue,q)},function(fe){ae("throw",fe,ue,q)}):w.resolve(ce).then(function(fe){ge.value=fe,ue(ge)},function(fe){return ae("throw",fe,ue,q)})}q(ve.arg)})(F,P,se,pe)})}return M=M?M.then(X,X):X()}}function O(k,w){var M=k.iterator[w.method];if(M===void 0){if(w.delegate=null,w.method==="throw"){if(k.iterator.return&&(w.method="return",w.arg=void 0,O(k,w),w.method==="throw"))return s;w.method="throw",w.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var F=v(M,k.iterator,w.arg);if(F.type==="throw")return w.method="throw",w.arg=F.arg,w.delegate=null,s;var P=F.arg;return P?P.done?(w[k.resultName]=P.value,w.next=k.nextLoc,w.method!=="return"&&(w.method="next",w.arg=void 0),w.delegate=null,s):P:(w.method="throw",w.arg=new TypeError("iterator result is not an object"),w.delegate=null,s)}function D(k){var w={tryLoc:k[0]};1 in k&&(w.catchLoc=k[1]),2 in k&&(w.finallyLoc=k[2],w.afterLoc=k[3]),this.tryEntries.push(w)}function x(k){var w=k.completion||{};w.type="normal",delete w.arg,k.completion=w}function ne(k){this.tryEntries=[{tryLoc:"root"}],k.forEach(D,this),this.reset(!0)}function Q(k){if(k){var w=k[d];if(w)return w.call(k);if(typeof k.next=="function")return k;if(!isNaN(k.length)){var M=-1,F=function P(){for(;++M<k.length;)if(e.call(k,M))return P.value=k[M],P.done=!1,P;return P.value=void 0,P.done=!0,P};return F.next=F}}return{next:B}}function B(){return{value:void 0,done:!0}}return t.prototype=R.constructor=i,i.constructor=t,i[g]=t.displayName="GeneratorFunction",n.isGeneratorFunction=function(k){var w=typeof k=="function"&&k.constructor;return!!w&&(w===t||(w.displayName||w.name)==="GeneratorFunction")},n.mark=function(k){return Object.setPrototypeOf?Object.setPrototypeOf(k,i):(k.__proto__=i,g in k||(k[g]="GeneratorFunction")),k.prototype=Object.create(R),k},n.awrap=function(k){return{__await:k}},b(E.prototype),E.prototype[r]=function(){return this},n.AsyncIterator=E,n.async=function(k,w,M,F,P){P===void 0&&(P=Promise);var X=new E(h(k,w,M,F),P);return n.isGeneratorFunction(w)?X:X.next().then(function(se){return se.done?se.value:X.next()})},b(R),R[g]="Generator",R[d]=function(){return this},R.toString=function(){return"[object Generator]"},n.keys=function(k){var w=[];for(var M in k)w.push(M);return w.reverse(),function F(){for(;w.length;){var P=w.pop();if(P in k)return F.value=P,F.done=!1,F}return F.done=!0,F}},n.values=Q,ne.prototype={constructor:ne,reset:function(k){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!k)for(var w in this)w.charAt(0)==="t"&&e.call(this,w)&&!isNaN(+w.slice(1))&&(this[w]=void 0)},stop:function(){this.done=!0;var k=this.tryEntries[0].completion;if(k.type==="throw")throw k.arg;return this.rval},dispatchException:function(k){if(this.done)throw k;var w=this;function M(ae,I){return X.type="throw",X.arg=k,w.next=ae,I&&(w.method="next",w.arg=void 0),!!I}for(var F=this.tryEntries.length-1;F>=0;--F){var P=this.tryEntries[F],X=P.completion;if(P.tryLoc==="root")return M("end");if(P.tryLoc<=this.prev){var se=e.call(P,"catchLoc"),pe=e.call(P,"finallyLoc");if(se&&pe){if(this.prev<P.catchLoc)return M(P.catchLoc,!0);if(this.prev<P.finallyLoc)return M(P.finallyLoc)}else if(se){if(this.prev<P.catchLoc)return M(P.catchLoc,!0)}else{if(!pe)throw new Error("try statement without catch or finally");if(this.prev<P.finallyLoc)return M(P.finallyLoc)}}}},abrupt:function(k,w){for(var M=this.tryEntries.length-1;M>=0;--M){var F=this.tryEntries[M];if(F.tryLoc<=this.prev&&e.call(F,"finallyLoc")&&this.prev<F.finallyLoc){var P=F;break}}P&&(k==="break"||k==="continue")&&P.tryLoc<=w&&w<=P.finallyLoc&&(P=null);var X=P?P.completion:{};return X.type=k,X.arg=w,P?(this.method="next",this.next=P.finallyLoc,s):this.complete(X)},complete:function(k,w){if(k.type==="throw")throw k.arg;return k.type==="break"||k.type==="continue"?this.next=k.arg:k.type==="return"?(this.rval=this.arg=k.arg,this.method="return",this.next="end"):k.type==="normal"&&w&&(this.next=w),s},finish:function(k){for(var w=this.tryEntries.length-1;w>=0;--w){var M=this.tryEntries[w];if(M.finallyLoc===k)return this.complete(M.completion,M.afterLoc),x(M),s}},catch:function(k){for(var w=this.tryEntries.length-1;w>=0;--w){var M=this.tryEntries[w];if(M.tryLoc===k){var F=M.completion;if(F.type==="throw"){var P=F.arg;x(M)}return P}}throw new Error("illegal catch attempt")},delegateYield:function(k,w,M){return this.delegate={iterator:Q(k),resultName:w,nextLoc:M},this.method==="next"&&(this.arg=void 0),s}},n}(j.exports);try{regeneratorRuntime=u}catch{Function("r","regeneratorRuntime = r")(u)}},function(j,Y){var _;_=function(){return this}();try{_=_||new Function("return this")()}catch{typeof window=="object"&&(_=window)}j.exports=_},function(j,Y,_){var u=_(1);j.exports=function(n,o){var e=n&&n.window,c={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var d in o)hasOwnProperty.call(o,d)&&(c[d]=o[d]);var r=u.log,g=u.detectBrowser(e),h=_(7)||null,v=_(9)||null,s=_(13)||null,f=_(15)||null,t=_(16)||null,i={browserDetails:g,commonShim:t,extractVersion:u.extractVersion,disableLog:u.disableLog,disableWarnings:u.disableWarnings};switch(g.browser){case"chrome":if(!h||!h.shimPeerConnection||!c.shimChrome)return r("Chrome shim is not included in this adapter release."),i;r("adapter.js shimming chrome."),i.browserShim=h,t.shimCreateObjectURL(e),h.shimGetUserMedia(e),h.shimMediaStream(e),h.shimSourceObject(e),h.shimPeerConnection(e),h.shimOnTrack(e),h.shimAddTrackRemoveTrack(e),h.shimGetSendersWithDtmf(e),h.shimSenderReceiverGetStats(e),h.fixNegotiationNeeded(e),t.shimRTCIceCandidate(e),t.shimMaxMessageSize(e),t.shimSendThrowTypeError(e);break;case"firefox":if(!s||!s.shimPeerConnection||!c.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=s,t.shimCreateObjectURL(e),s.shimGetUserMedia(e),s.shimSourceObject(e),s.shimPeerConnection(e),s.shimOnTrack(e),s.shimRemoveStream(e),s.shimSenderGetStats(e),s.shimReceiverGetStats(e),s.shimRTCDataChannel(e),t.shimRTCIceCandidate(e),t.shimMaxMessageSize(e),t.shimSendThrowTypeError(e);break;case"edge":if(!v||!v.shimPeerConnection||!c.shimEdge)return r("MS edge shim is not included in this adapter release."),i;r("adapter.js shimming edge."),i.browserShim=v,t.shimCreateObjectURL(e),v.shimGetUserMedia(e),v.shimPeerConnection(e),v.shimReplaceTrack(e),v.shimGetDisplayMedia(e),t.shimMaxMessageSize(e),t.shimSendThrowTypeError(e);break;case"safari":if(!f||!c.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=f,t.shimCreateObjectURL(e),f.shimRTCIceServerUrls(e),f.shimCreateOfferLegacy(e),f.shimCallbacksAPI(e),f.shimLocalStreamsAPI(e),f.shimRemoteStreamsAPI(e),f.shimTrackEventTransceiver(e),f.shimGetUserMedia(e),t.shimRTCIceCandidate(e),t.shimMaxMessageSize(e),t.shimSendThrowTypeError(e);break;default:r("Unsupported browser!")}return i}},function(j,Y,_){var u=_(1),n=u.log;function o(e,c,d){var r=d?"outbound-rtp":"inbound-rtp",g=new Map;if(c===null)return g;var h=[];return e.forEach(function(v){v.type==="track"&&v.trackIdentifier===c.id&&h.push(v)}),h.forEach(function(v){e.forEach(function(s){s.type===r&&s.trackId===v.id&&function f(t,i,a){i&&!a.has(i.id)&&(a.set(i.id,i),Object.keys(i).forEach(function(p){p.endsWith("Id")?f(t,t.get(i[p]),a):p.endsWith("Ids")&&i[p].forEach(function(y){f(t,t.get(y),a)})}))}(e,s,g)})}),g}j.exports={shimGetUserMedia:_(8),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(d){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=d)},enumerable:!0,configurable:!0});var c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var d=this;return d._ontrackpoly||(d._ontrackpoly=function(r){r.stream.addEventListener("addtrack",function(g){var h;h=e.RTCPeerConnection.prototype.getReceivers?d.getReceivers().find(function(s){return s.track&&s.track.id===g.track.id}):{track:g.track};var v=new Event("track");v.track=g.track,v.receiver=h,v.transceiver={receiver:h},v.streams=[r.stream],d.dispatchEvent(v)}),r.stream.getTracks().forEach(function(g){var h;h=e.RTCPeerConnection.prototype.getReceivers?d.getReceivers().find(function(s){return s.track&&s.track.id===g.id}):{track:g};var v=new Event("track");v.track=g,v.receiver=h,v.transceiver={receiver:h},v.streams=[r.stream],d.dispatchEvent(v)})},d.addEventListener("addstream",d._ontrackpoly)),c.apply(d,arguments)}}else u.wrapPeerConnectionEvent(e,"track",function(d){return d.transceiver||Object.defineProperty(d,"transceiver",{value:{receiver:d.receiver}}),d})},shimGetSendersWithDtmf:function(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var c=function(s,f){return{track:f,get dtmf(){return this._dtmf===void 0&&(f.kind==="audio"?this._dtmf=s.createDTMFSender(f):this._dtmf=null),this._dtmf},_pc:s}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var d=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,f){var t=this,i=d.apply(t,arguments);return i||(i=c(t,s),t._senders.push(i)),i};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){var f=this;r.apply(f,arguments);var t=f._senders.indexOf(s);t!==-1&&f._senders.splice(t,1)}}var g=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){var f=this;f._senders=f._senders||[],g.apply(f,[s]),s.getTracks().forEach(function(t){f._senders.push(c(f,t))})};var h=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){var f=this;f._senders=f._senders||[],h.apply(f,[s]),s.getTracks().forEach(function(t){var i=f._senders.find(function(a){return a.track===t});i&&f._senders.splice(f._senders.indexOf(i),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var v=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var s=this,f=v.apply(s,[]);return f.forEach(function(t){t._pc=s}),f},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var c=e.RTCPeerConnection.prototype.getSenders;c&&(e.RTCPeerConnection.prototype.getSenders=function(){var h=this,v=c.apply(h,[]);return v.forEach(function(s){s._pc=h}),v});var d=e.RTCPeerConnection.prototype.addTrack;d&&(e.RTCPeerConnection.prototype.addTrack=function(){var h=d.apply(this,arguments);return h._pc=this,h}),e.RTCRtpSender.prototype.getStats=function(){var h=this;return this._pc.getStats().then(function(v){return o(v,h.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){var h=this,v=r.apply(h,[]);return v.forEach(function(s){s._pc=h}),v}),u.wrapPeerConnectionEvent(e,"track",function(h){return h.receiver._pc=h.srcElement,h}),e.RTCRtpReceiver.prototype.getStats=function(){var h=this;return this._pc.getStats().then(function(v){return o(v,h.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var g=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var h=this;if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var v,s,f,t=arguments[0];return h.getSenders().forEach(function(i){i.track===t&&(v?f=!0:v=i)}),h.getReceivers().forEach(function(i){return i.track===t&&(s?f=!0:s=i),i.track===t}),f||v&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):v?v.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return g.apply(h,arguments)}}}},shimSourceObject:function(e){var c=e&&e.URL;typeof e=="object"&&e.HTMLMediaElement&&!("srcObject"in e.HTMLMediaElement.prototype)&&Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(d){var r=this;this._srcObject=d,this.src&&c.revokeObjectURL(this.src),d?(this.src=c.createObjectURL(d),d.addEventListener("addtrack",function(){r.src&&c.revokeObjectURL(r.src),r.src=c.createObjectURL(d)}),d.addEventListener("removetrack",function(){r.src&&c.revokeObjectURL(r.src),r.src=c.createObjectURL(d)})):this.src=""}})},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var h=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(v){return h._shimmedLocalStreams[v][0]})};var c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,v){if(!v)return c.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var s=c.apply(this,arguments);return this._shimmedLocalStreams[v.id]?this._shimmedLocalStreams[v.id].indexOf(s)===-1&&this._shimmedLocalStreams[v.id].push(s):this._shimmedLocalStreams[v.id]=[v,s],s};var d=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(h){var v=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},h.getTracks().forEach(function(t){if(v.getSenders().find(function(i){return i.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")});var s=v.getSenders();d.apply(this,arguments);var f=v.getSenders().filter(function(t){return s.indexOf(t)===-1});this._shimmedLocalStreams[h.id]=[h].concat(f)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(h){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[h.id],r.apply(this,arguments)};var g=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){var v=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},h&&Object.keys(this._shimmedLocalStreams).forEach(function(s){var f=v._shimmedLocalStreams[s].indexOf(h);f!==-1&&v._shimmedLocalStreams[s].splice(f,1),v._shimmedLocalStreams[s].length===1&&delete v._shimmedLocalStreams[s]}),g.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){if(e.RTCPeerConnection){var c=u.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&c.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var d=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this,i=d.apply(this);return t._reverseStreams=t._reverseStreams||{},i.map(function(a){return t._reverseStreams[a.id]})};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var i=this;if(i._streams=i._streams||{},i._reverseStreams=i._reverseStreams||{},t.getTracks().forEach(function(p){if(i.getSenders().find(function(y){return y.track===p}))throw new DOMException("Track already exists.","InvalidAccessError")}),!i._reverseStreams[t.id]){var a=new e.MediaStream(t.getTracks());i._streams[t.id]=a,i._reverseStreams[a.id]=t,t=a}r.apply(i,[t])};var g=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(t){var i=this;i._streams=i._streams||{},i._reverseStreams=i._reverseStreams||{},g.apply(i,[i._streams[t.id]||t]),delete i._reverseStreams[i._streams[t.id]?i._streams[t.id].id:t.id],delete i._streams[t.id]},e.RTCPeerConnection.prototype.addTrack=function(t,i){var a=this;if(a.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(function(E){return E===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var y=a.getSenders().find(function(E){return E.track===t});if(y)throw new DOMException("Track already exists.","InvalidAccessError");a._streams=a._streams||{},a._reverseStreams=a._reverseStreams||{};var R=a._streams[i.id];if(R)R.addTrack(t),Promise.resolve().then(function(){a.dispatchEvent(new Event("negotiationneeded"))});else{var b=new e.MediaStream([t]);a._streams[i.id]=b,a._reverseStreams[b.id]=i,a.addStream(b)}return a.getSenders().find(function(E){return E.track===t})},["createOffer","createAnswer"].forEach(function(t){var i=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var a=this,p=arguments,y=arguments.length&&typeof arguments[0]=="function";return y?i.apply(a,[function(R){var b=s(a,R);p[0].apply(null,[b])},function(R){p[1]&&p[1].apply(null,R)},arguments[2]]):i.apply(a,arguments).then(function(R){return s(a,R)})}});var h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var t=this;return arguments.length&&arguments[0].type&&(arguments[0]=f(t,arguments[0])),h.apply(t,arguments)};var v=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var t=v.get.apply(this);return t.type===""?t:s(this,t)}}),e.RTCPeerConnection.prototype.removeTrack=function(t){var i,a=this;if(a.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(t._pc!==a)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");a._streams=a._streams||{},Object.keys(a._streams).forEach(function(p){a._streams[p].getTracks().find(function(y){return t.track===y})&&(i=a._streams[p])}),i&&(i.getTracks().length===1?a.removeStream(a._reverseStreams[i.id]):i.removeTrack(t.track),a.dispatchEvent(new Event("negotiationneeded")))}}function s(t,i){var a=i.sdp;return Object.keys(t._reverseStreams||[]).forEach(function(p){var y=t._reverseStreams[p],R=t._streams[y.id];a=a.replace(new RegExp(R.id,"g"),y.id)}),new RTCSessionDescription({type:i.type,sdp:a})}function f(t,i){var a=i.sdp;return Object.keys(t._reverseStreams||[]).forEach(function(p){var y=t._reverseStreams[p],R=t._streams[y.id];a=a.replace(new RegExp(y.id,"g"),R.id)}),new RTCSessionDescription({type:i.type,sdp:a})}},shimPeerConnection:function(e){var c=u.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=function(g,h){return n("PeerConnection"),g&&g.iceTransportPolicy&&(g.iceTransports=g.iceTransportPolicy),new e.webkitRTCPeerConnection(g,h)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}})),e.RTCPeerConnection){var d=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(g,h,v){var s=this,f=arguments;if(arguments.length>0&&typeof g=="function")return d.apply(this,arguments);if(d.length===0&&(arguments.length===0||typeof arguments[0]!="function"))return d.apply(this,[]);var t=function(p){var y={};return p.result().forEach(function(R){var b={id:R.id,timestamp:R.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[R.type]||R.type};R.names().forEach(function(E){b[E]=R.stat(E)}),y[b.id]=b}),y},i=function(p){return new Map(Object.keys(p).map(function(y){return[y,p[y]]}))};if(arguments.length>=2){var a=function(p){f[1](i(t(p)))};return d.apply(this,[a,arguments[0]])}return new Promise(function(p,y){d.apply(s,[function(R){p(i(t(R)))},y])}).then(h,v)},c.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(g){var h=e.RTCPeerConnection.prototype[g];e.RTCPeerConnection.prototype[g]=function(){var v=arguments,s=this,f=new Promise(function(t,i){h.apply(s,[v[0],t,i])});return v.length<2?f:f.then(function(){v[1].apply(null,[])},function(t){v.length>=3&&v[2].apply(null,[t])})}}),c.version<52&&["createOffer","createAnswer"].forEach(function(g){var h=e.RTCPeerConnection.prototype[g];e.RTCPeerConnection.prototype[g]=function(){var v=this;if(arguments.length<1||arguments.length===1&&typeof arguments[0]=="object"){var s=arguments.length===1?arguments[0]:void 0;return new Promise(function(f,t){h.apply(v,[f,t,s])})}return h.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(g){var h=e.RTCPeerConnection.prototype[g];e.RTCPeerConnection.prototype[g]=function(){return arguments[0]=new(g==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),h.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},fixNegotiationNeeded:function(e){u.wrapPeerConnectionEvent(e,"negotiationneeded",function(c){if(c.target.signalingState==="stable")return c})},shimGetDisplayMedia:function(e,c){e.navigator&&e.navigator.mediaDevices&&!("getDisplayMedia"in e.navigator.mediaDevices)&&(typeof c=="function"?(e.navigator.mediaDevices.getDisplayMedia=function(d){return c(d).then(function(r){var g=d.video&&d.video.width,h=d.video&&d.video.height,v=d.video&&d.video.frameRate;return d.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:v||3}},g&&(d.video.mandatory.maxWidth=g),h&&(d.video.mandatory.maxHeight=h),e.navigator.mediaDevices.getUserMedia(d)})},e.navigator.getDisplayMedia=function(d){return u.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),e.navigator.mediaDevices.getDisplayMedia(d)}):console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}},function(j,Y,_){var u=_(1),n=u.log;j.exports=function(o){var e=u.detectBrowser(o),c=o&&o.navigator,d=function(s){if(typeof s!="object"||s.mandatory||s.optional)return s;var f={};return Object.keys(s).forEach(function(t){if(t!=="require"&&t!=="advanced"&&t!=="mediaSource"){var i=typeof s[t]=="object"?s[t]:{ideal:s[t]};i.exact!==void 0&&typeof i.exact=="number"&&(i.min=i.max=i.exact);var a=function(y,R){return y?y+R.charAt(0).toUpperCase()+R.slice(1):R==="deviceId"?"sourceId":R};if(i.ideal!==void 0){f.optional=f.optional||[];var p={};typeof i.ideal=="number"?(p[a("min",t)]=i.ideal,f.optional.push(p),(p={})[a("max",t)]=i.ideal,f.optional.push(p)):(p[a("",t)]=i.ideal,f.optional.push(p))}i.exact!==void 0&&typeof i.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[a("",t)]=i.exact):["min","max"].forEach(function(y){i[y]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[a(y,t)]=i[y])})}}),s.advanced&&(f.optional=(f.optional||[]).concat(s.advanced)),f},r=function(s,f){if(e.version>=61)return f(s);if((s=JSON.parse(JSON.stringify(s)))&&typeof s.audio=="object"){var t=function(y,R,b){R in y&&!(b in y)&&(y[b]=y[R],delete y[R])};t((s=JSON.parse(JSON.stringify(s))).audio,"autoGainControl","googAutoGainControl"),t(s.audio,"noiseSuppression","googNoiseSuppression"),s.audio=d(s.audio)}if(s&&typeof s.video=="object"){var i=s.video.facingMode;i=i&&(typeof i=="object"?i:{ideal:i});var a,p=e.version<66;if(i&&(i.exact==="user"||i.exact==="environment"||i.ideal==="user"||i.ideal==="environment")&&(!c.mediaDevices.getSupportedConstraints||!c.mediaDevices.getSupportedConstraints().facingMode||p)&&(delete s.video.facingMode,i.exact==="environment"||i.ideal==="environment"?a=["back","rear"]:i.exact!=="user"&&i.ideal!=="user"||(a=["front"]),a))return c.mediaDevices.enumerateDevices().then(function(y){var R=(y=y.filter(function(b){return b.kind==="videoinput"})).find(function(b){return a.some(function(E){return b.label.toLowerCase().indexOf(E)!==-1})});return!R&&y.length&&a.indexOf("back")!==-1&&(R=y[y.length-1]),R&&(s.video.deviceId=i.exact?{exact:R.deviceId}:{ideal:R.deviceId}),s.video=d(s.video),n("chrome: "+JSON.stringify(s)),f(s)});s.video=d(s.video)}return n("chrome: "+JSON.stringify(s)),f(s)},g=function(s){return e.version>=64?s:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[s.name]||s.name,message:s.message,constraint:s.constraint||s.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};c.getUserMedia=function(s,f,t){r(s,function(i){c.webkitGetUserMedia(i,f,function(a){t&&t(g(a))})})};var h=function(s){return new Promise(function(f,t){c.getUserMedia(s,f,t)})};if(c.mediaDevices||(c.mediaDevices={getUserMedia:h,enumerateDevices:function(){return new Promise(function(s){var f={audio:"audioinput",video:"videoinput"};return o.MediaStreamTrack.getSources(function(t){s(t.map(function(i){return{label:i.label,kind:f[i.kind],deviceId:i.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),c.mediaDevices.getUserMedia){var v=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(s){return r(s,function(f){return v(f).then(function(t){if(f.audio&&!t.getAudioTracks().length||f.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(i){i.stop()}),new DOMException("","NotFoundError");return t},function(t){return Promise.reject(g(t))})})}}else c.mediaDevices.getUserMedia=function(s){return h(s)};c.mediaDevices.addEventListener===void 0&&(c.mediaDevices.addEventListener=function(){n("Dummy mediaDevices.addEventListener called.")}),c.mediaDevices.removeEventListener===void 0&&(c.mediaDevices.removeEventListener=function(){n("Dummy mediaDevices.removeEventListener called.")})}},function(j,Y,_){var u=_(1),n=_(10),o=_(11);j.exports={shimGetUserMedia:_(12),shimPeerConnection:function(e){var c=u.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(g){return g}),e.RTCSessionDescription||(e.RTCSessionDescription=function(g){return g}),c.version<15025)){var d=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(g){d.set.call(this,g);var h=new Event("enabled");h.enabled=g,this.dispatchEvent(h)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new e.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var r=o(e,c.version);e.RTCPeerConnection=function(g){return g&&g.iceServers&&(g.iceServers=n(g.iceServers)),new r(g)},e.RTCPeerConnection.prototype=r.prototype},shimReplaceTrack:function(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)},shimGetDisplayMedia:function(e,c){if("getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&!("getDisplayMedia"in e.navigator.mediaDevices)){var d=e.navigator.getDisplayMedia;e.navigator.mediaDevices.getDisplayMedia=function(r){return d.call(e.navigator,r)},e.navigator.getDisplayMedia=function(r){return u.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),d.call(e.navigator,r)}}}}},function(j,Y,_){var u=_(1);j.exports=function(n,o){var e=!1;return(n=JSON.parse(JSON.stringify(n))).filter(function(c){if(c&&(c.urls||c.url)){var d=c.urls||c.url;c.url&&!c.urls&&u.deprecated("RTCIceServer.url","RTCIceServer.urls");var r=typeof d=="string";return r&&(d=[d]),d=d.filter(function(g){return g.indexOf("turn:")===0&&g.indexOf("transport=udp")!==-1&&g.indexOf("turn:[")===-1&&!e?(e=!0,!0):g.indexOf("stun:")===0&&o>=14393&&g.indexOf("?transport=udp")===-1}),delete c.url,c.urls=r?d[0]:d,!!d.length}})}},function(j,Y,_){var u=_(2);function n(r,g,h,v,s){var f=u.writeRtpDescription(r.kind,g);if(f+=u.writeIceParameters(r.iceGatherer.getLocalParameters()),f+=u.writeDtlsParameters(r.dtlsTransport.getLocalParameters(),h==="offer"?"actpass":s||"active"),f+="a=mid:"+r.mid+`\r
`,r.rtpSender&&r.rtpReceiver?f+=`a=sendrecv\r
`:r.rtpSender?f+=`a=sendonly\r
`:r.rtpReceiver?f+=`a=recvonly\r
`:f+=`a=inactive\r
`,r.rtpSender){var t=r.rtpSender._initialTrackId||r.rtpSender.track.id;r.rtpSender._initialTrackId=t;var i="msid:"+(v?v.id:"-")+" "+t+`\r
`;f+="a="+i,f+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" "+i,r.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" "+i,f+="a=ssrc-group:FID "+r.sendEncodingParameters[0].ssrc+" "+r.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return f+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" cname:"+u.localCName+`\r
`,r.rtpSender&&r.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" cname:"+u.localCName+`\r
`),f}function o(r,g){var h={codecs:[],headerExtensions:[],fecMechanisms:[]},v=function(f,t){f=parseInt(f,10);for(var i=0;i<t.length;i++)if(t[i].payloadType===f||t[i].preferredPayloadType===f)return t[i]},s=function(f,t,i,a){var p=v(f.parameters.apt,i),y=v(t.parameters.apt,a);return p&&y&&p.name.toLowerCase()===y.name.toLowerCase()};return r.codecs.forEach(function(f){for(var t=0;t<g.codecs.length;t++){var i=g.codecs[t];if(f.name.toLowerCase()===i.name.toLowerCase()&&f.clockRate===i.clockRate){if(f.name.toLowerCase()==="rtx"&&f.parameters&&i.parameters.apt&&!s(f,i,r.codecs,g.codecs))continue;(i=JSON.parse(JSON.stringify(i))).numChannels=Math.min(f.numChannels,i.numChannels),h.codecs.push(i),i.rtcpFeedback=i.rtcpFeedback.filter(function(a){for(var p=0;p<f.rtcpFeedback.length;p++)if(f.rtcpFeedback[p].type===a.type&&f.rtcpFeedback[p].parameter===a.parameter)return!0;return!1});break}}}),r.headerExtensions.forEach(function(f){for(var t=0;t<g.headerExtensions.length;t++){var i=g.headerExtensions[t];if(f.uri===i.uri){h.headerExtensions.push(i);break}}}),h}function e(r,g,h){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[g][r].indexOf(h)!==-1}function c(r,g){var h=r.getRemoteCandidates().find(function(v){return g.foundation===v.foundation&&g.ip===v.ip&&g.port===v.port&&g.priority===v.priority&&g.protocol===v.protocol&&g.type===v.type});return h||r.addRemoteCandidate(g),!h}function d(r,g){var h=new Error(g);return h.name=r,h.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[r],h}j.exports=function(r,g){function h(t,i){i.addTrack(t),i.dispatchEvent(new r.MediaStreamTrackEvent("addtrack",{track:t}))}function v(t,i,a,p){var y=new Event("track");y.track=i,y.receiver=a,y.transceiver={receiver:a},y.streams=p,r.setTimeout(function(){t._dispatchEvent("track",y)})}var s=function(t){var i=this,a=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(y){i[y]=a[y].bind(a)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",t=JSON.parse(JSON.stringify(t||{})),this.usingBundle=t.bundlePolicy==="max-bundle",t.rtcpMuxPolicy==="negotiate")throw d("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(t.rtcpMuxPolicy||(t.rtcpMuxPolicy="require"),t.iceTransportPolicy){case"all":case"relay":break;default:t.iceTransportPolicy="all"}switch(t.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:t.bundlePolicy="balanced"}if(t.iceServers=function(y,R){var b=!1;return(y=JSON.parse(JSON.stringify(y))).filter(function(E){if(E&&(E.urls||E.url)){var O=E.urls||E.url;E.url&&!E.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var D=typeof O=="string";return D&&(O=[O]),O=O.filter(function(x){return x.indexOf("turn:")===0&&x.indexOf("transport=udp")!==-1&&x.indexOf("turn:[")===-1&&!b?(b=!0,!0):x.indexOf("stun:")===0&&R>=14393&&x.indexOf("?transport=udp")===-1}),delete E.url,E.urls=D?O[0]:O,!!O.length}})}(t.iceServers||[],g),this._iceGatherers=[],t.iceCandidatePoolSize)for(var p=t.iceCandidatePoolSize;p>0;p--)this._iceGatherers.push(new r.RTCIceGatherer({iceServers:t.iceServers,gatherPolicy:t.iceTransportPolicy}));else t.iceCandidatePoolSize=0;this._config=t,this.transceivers=[],this._sdpSessionId=u.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(s.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(s.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),s.prototype.onicecandidate=null,s.prototype.onaddstream=null,s.prototype.ontrack=null,s.prototype.onremovestream=null,s.prototype.onsignalingstatechange=null,s.prototype.oniceconnectionstatechange=null,s.prototype.onconnectionstatechange=null,s.prototype.onicegatheringstatechange=null,s.prototype.onnegotiationneeded=null,s.prototype.ondatachannel=null,s.prototype._dispatchEvent=function(t,i){this._isClosed||(this.dispatchEvent(i),typeof this["on"+t]=="function"&&this["on"+t](i))},s.prototype._emitGatheringStateChange=function(){var t=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",t)},s.prototype.getConfiguration=function(){return this._config},s.prototype.getLocalStreams=function(){return this.localStreams},s.prototype.getRemoteStreams=function(){return this.remoteStreams},s.prototype._createTransceiver=function(t,i){var a=this.transceivers.length>0,p={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:t,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&a)p.iceTransport=this.transceivers[0].iceTransport,p.dtlsTransport=this.transceivers[0].dtlsTransport;else{var y=this._createIceAndDtlsTransports();p.iceTransport=y.iceTransport,p.dtlsTransport=y.dtlsTransport}return i||this.transceivers.push(p),p},s.prototype.addTrack=function(t,i){if(this._isClosed)throw d("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var a;if(this.transceivers.find(function(y){return y.track===t}))throw d("InvalidAccessError","Track already exists.");for(var p=0;p<this.transceivers.length;p++)this.transceivers[p].track||this.transceivers[p].kind!==t.kind||(a=this.transceivers[p]);return a||(a=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(i)===-1&&this.localStreams.push(i),a.track=t,a.stream=i,a.rtpSender=new r.RTCRtpSender(t,a.dtlsTransport),a.rtpSender},s.prototype.addStream=function(t){var i=this;if(g>=15025)t.getTracks().forEach(function(p){i.addTrack(p,t)});else{var a=t.clone();t.getTracks().forEach(function(p,y){var R=a.getTracks()[y];p.addEventListener("enabled",function(b){R.enabled=b.enabled})}),a.getTracks().forEach(function(p){i.addTrack(p,a)})}},s.prototype.removeTrack=function(t){if(this._isClosed)throw d("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof r.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var i=this.transceivers.find(function(p){return p.rtpSender===t});if(!i)throw d("InvalidAccessError","Sender was not created by this connection.");var a=i.stream;i.rtpSender.stop(),i.rtpSender=null,i.track=null,i.stream=null,this.transceivers.map(function(p){return p.stream}).indexOf(a)===-1&&this.localStreams.indexOf(a)>-1&&this.localStreams.splice(this.localStreams.indexOf(a),1),this._maybeFireNegotiationNeeded()},s.prototype.removeStream=function(t){var i=this;t.getTracks().forEach(function(a){var p=i.getSenders().find(function(y){return y.track===a});p&&i.removeTrack(p)})},s.prototype.getSenders=function(){return this.transceivers.filter(function(t){return!!t.rtpSender}).map(function(t){return t.rtpSender})},s.prototype.getReceivers=function(){return this.transceivers.filter(function(t){return!!t.rtpReceiver}).map(function(t){return t.rtpReceiver})},s.prototype._createIceGatherer=function(t,i){var a=this;if(i&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var p=new r.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(p,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(y){var R=!y.candidate||Object.keys(y.candidate).length===0;p.state=R?"completed":"gathering",a.transceivers[t].bufferedCandidateEvents!==null&&a.transceivers[t].bufferedCandidateEvents.push(y)},p.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),p},s.prototype._gather=function(t,i){var a=this,p=this.transceivers[i].iceGatherer;if(!p.onlocalcandidate){var y=this.transceivers[i].bufferedCandidateEvents;this.transceivers[i].bufferedCandidateEvents=null,p.removeEventListener("localcandidate",this.transceivers[i].bufferCandidates),p.onlocalcandidate=function(R){if(!(a.usingBundle&&i>0)){var b=new Event("icecandidate");b.candidate={sdpMid:t,sdpMLineIndex:i};var E=R.candidate,O=!E||Object.keys(E).length===0;if(O)p.state!=="new"&&p.state!=="gathering"||(p.state="completed");else{p.state==="new"&&(p.state="gathering"),E.component=1,E.ufrag=p.getLocalParameters().usernameFragment;var D=u.writeCandidate(E);b.candidate=Object.assign(b.candidate,u.parseCandidate(D)),b.candidate.candidate=D,b.candidate.toJSON=function(){return{candidate:b.candidate.candidate,sdpMid:b.candidate.sdpMid,sdpMLineIndex:b.candidate.sdpMLineIndex,usernameFragment:b.candidate.usernameFragment}}}var x=u.getMediaSections(a._localDescription.sdp);x[b.candidate.sdpMLineIndex]+=O?`a=end-of-candidates\r
`:"a="+b.candidate.candidate+`\r
`,a._localDescription.sdp=u.getDescription(a._localDescription.sdp)+x.join("");var ne=a.transceivers.every(function(Q){return Q.iceGatherer&&Q.iceGatherer.state==="completed"});a.iceGatheringState!=="gathering"&&(a.iceGatheringState="gathering",a._emitGatheringStateChange()),O||a._dispatchEvent("icecandidate",b),ne&&(a._dispatchEvent("icecandidate",new Event("icecandidate")),a.iceGatheringState="complete",a._emitGatheringStateChange())}},r.setTimeout(function(){y.forEach(function(R){p.onlocalcandidate(R)})},0)}},s.prototype._createIceAndDtlsTransports=function(){var t=this,i=new r.RTCIceTransport(null);i.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var a=new r.RTCDtlsTransport(i);return a.ondtlsstatechange=function(){t._updateConnectionState()},a.onerror=function(){Object.defineProperty(a,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:i,dtlsTransport:a}},s.prototype._disposeIceAndDtlsTransports=function(t){var i=this.transceivers[t].iceGatherer;i&&(delete i.onlocalcandidate,delete this.transceivers[t].iceGatherer);var a=this.transceivers[t].iceTransport;a&&(delete a.onicestatechange,delete this.transceivers[t].iceTransport);var p=this.transceivers[t].dtlsTransport;p&&(delete p.ondtlsstatechange,delete p.onerror,delete this.transceivers[t].dtlsTransport)},s.prototype._transceive=function(t,i,a){var p=o(t.localCapabilities,t.remoteCapabilities);i&&t.rtpSender&&(p.encodings=t.sendEncodingParameters,p.rtcp={cname:u.localCName,compound:t.rtcpParameters.compound},t.recvEncodingParameters.length&&(p.rtcp.ssrc=t.recvEncodingParameters[0].ssrc),t.rtpSender.send(p)),a&&t.rtpReceiver&&p.codecs.length>0&&(t.kind==="video"&&t.recvEncodingParameters&&g<15019&&t.recvEncodingParameters.forEach(function(y){delete y.rtx}),t.recvEncodingParameters.length?p.encodings=t.recvEncodingParameters:p.encodings=[{}],p.rtcp={compound:t.rtcpParameters.compound},t.rtcpParameters.cname&&(p.rtcp.cname=t.rtcpParameters.cname),t.sendEncodingParameters.length&&(p.rtcp.ssrc=t.sendEncodingParameters[0].ssrc),t.rtpReceiver.receive(p))},s.prototype.setLocalDescription=function(t){var i,a,p=this;if(["offer","answer"].indexOf(t.type)===-1)return Promise.reject(d("TypeError",'Unsupported type "'+t.type+'"'));if(!e("setLocalDescription",t.type,p.signalingState)||p._isClosed)return Promise.reject(d("InvalidStateError","Can not set local "+t.type+" in state "+p.signalingState));if(t.type==="offer")i=u.splitSections(t.sdp),a=i.shift(),i.forEach(function(R,b){var E=u.parseRtpParameters(R);p.transceivers[b].localCapabilities=E}),p.transceivers.forEach(function(R,b){p._gather(R.mid,b)});else if(t.type==="answer"){i=u.splitSections(p._remoteDescription.sdp),a=i.shift();var y=u.matchPrefix(a,"a=ice-lite").length>0;i.forEach(function(R,b){var E=p.transceivers[b],O=E.iceGatherer,D=E.iceTransport,x=E.dtlsTransport,ne=E.localCapabilities,Q=E.remoteCapabilities;if(!(u.isRejected(R)&&u.matchPrefix(R,"a=bundle-only").length===0)&&!E.rejected){var B=u.getIceParameters(R,a),k=u.getDtlsParameters(R,a);y&&(k.role="server"),p.usingBundle&&b!==0||(p._gather(E.mid,b),D.state==="new"&&D.start(O,B,y?"controlling":"controlled"),x.state==="new"&&x.start(k));var w=o(ne,Q);p._transceive(E,w.codecs.length>0,!1)}})}return p._localDescription={type:t.type,sdp:t.sdp},t.type==="offer"?p._updateSignalingState("have-local-offer"):p._updateSignalingState("stable"),Promise.resolve()},s.prototype.setRemoteDescription=function(t){var i=this;if(["offer","answer"].indexOf(t.type)===-1)return Promise.reject(d("TypeError",'Unsupported type "'+t.type+'"'));if(!e("setRemoteDescription",t.type,i.signalingState)||i._isClosed)return Promise.reject(d("InvalidStateError","Can not set remote "+t.type+" in state "+i.signalingState));var a={};i.remoteStreams.forEach(function(D){a[D.id]=D});var p=[],y=u.splitSections(t.sdp),R=y.shift(),b=u.matchPrefix(R,"a=ice-lite").length>0,E=u.matchPrefix(R,"a=group:BUNDLE ").length>0;i.usingBundle=E;var O=u.matchPrefix(R,"a=ice-options:")[0];return i.canTrickleIceCandidates=!!O&&O.substr(14).split(" ").indexOf("trickle")>=0,y.forEach(function(D,x){var ne=u.splitLines(D),Q=u.getKind(D),B=u.isRejected(D)&&u.matchPrefix(D,"a=bundle-only").length===0,k=ne[0].substr(2).split(" ")[2],w=u.getDirection(D,R),M=u.parseMsid(D),F=u.getMid(D)||u.generateIdentifier();if(B||Q==="application"&&(k==="DTLS/SCTP"||k==="UDP/DTLS/SCTP"))i.transceivers[x]={mid:F,kind:Q,protocol:k,rejected:!0};else{var P,X,se,pe,ae,I,W,ue,q;!B&&i.transceivers[x]&&i.transceivers[x].rejected&&(i.transceivers[x]=i._createTransceiver(Q,!0));var ve,ge,ce=u.parseRtpParameters(D);B||(ve=u.getIceParameters(D,R),(ge=u.getDtlsParameters(D,R)).role="client"),W=u.parseRtpEncodingParameters(D);var fe=u.parseRtcpParameters(D),Ie=u.matchPrefix(D,"a=end-of-candidates",R).length>0,be=u.matchPrefix(D,"a=candidate:").map(function(te){return u.parseCandidate(te)}).filter(function(te){return te.component===1});if((t.type==="offer"||t.type==="answer")&&!B&&E&&x>0&&i.transceivers[x]&&(i._disposeIceAndDtlsTransports(x),i.transceivers[x].iceGatherer=i.transceivers[0].iceGatherer,i.transceivers[x].iceTransport=i.transceivers[0].iceTransport,i.transceivers[x].dtlsTransport=i.transceivers[0].dtlsTransport,i.transceivers[x].rtpSender&&i.transceivers[x].rtpSender.setTransport(i.transceivers[0].dtlsTransport),i.transceivers[x].rtpReceiver&&i.transceivers[x].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)),t.type!=="offer"||B)t.type==="answer"&&!B&&(X=(P=i.transceivers[x]).iceGatherer,se=P.iceTransport,pe=P.dtlsTransport,ae=P.rtpReceiver,I=P.sendEncodingParameters,ue=P.localCapabilities,i.transceivers[x].recvEncodingParameters=W,i.transceivers[x].remoteCapabilities=ce,i.transceivers[x].rtcpParameters=fe,be.length&&se.state==="new"&&(!b&&!Ie||E&&x!==0?be.forEach(function(te){c(P.iceTransport,te)}):se.setRemoteCandidates(be)),E&&x!==0||(se.state==="new"&&se.start(X,ve,"controlling"),pe.state==="new"&&pe.start(ge)),!o(P.localCapabilities,P.remoteCapabilities).codecs.filter(function(te){return te.name.toLowerCase()==="rtx"}).length&&P.sendEncodingParameters[0].rtx&&delete P.sendEncodingParameters[0].rtx,i._transceive(P,w==="sendrecv"||w==="recvonly",w==="sendrecv"||w==="sendonly"),!ae||w!=="sendrecv"&&w!=="sendonly"?delete P.rtpReceiver:(q=ae.track,M?(a[M.stream]||(a[M.stream]=new r.MediaStream),h(q,a[M.stream]),p.push([q,ae,a[M.stream]])):(a.default||(a.default=new r.MediaStream),h(q,a.default),p.push([q,ae,a.default]))));else{(P=i.transceivers[x]||i._createTransceiver(Q)).mid=F,P.iceGatherer||(P.iceGatherer=i._createIceGatherer(x,E)),be.length&&P.iceTransport.state==="new"&&(!Ie||E&&x!==0?be.forEach(function(te){c(P.iceTransport,te)}):P.iceTransport.setRemoteCandidates(be)),ue=r.RTCRtpReceiver.getCapabilities(Q),g<15019&&(ue.codecs=ue.codecs.filter(function(te){return te.name!=="rtx"})),I=P.sendEncodingParameters||[{ssrc:1001*(2*x+2)}];var ke,V=!1;w==="sendrecv"||w==="sendonly"?(V=!P.rtpReceiver,ae=P.rtpReceiver||new r.RTCRtpReceiver(P.dtlsTransport,Q),V&&(q=ae.track,M&&M.stream==="-"||(M?(a[M.stream]||(a[M.stream]=new r.MediaStream,Object.defineProperty(a[M.stream],"id",{get:function(){return M.stream}})),Object.defineProperty(q,"id",{get:function(){return M.track}}),ke=a[M.stream]):(a.default||(a.default=new r.MediaStream),ke=a.default)),ke&&(h(q,ke),P.associatedRemoteMediaStreams.push(ke)),p.push([q,ae,ke]))):P.rtpReceiver&&P.rtpReceiver.track&&(P.associatedRemoteMediaStreams.forEach(function(te){var De=te.getTracks().find(function(Ce){return Ce.id===P.rtpReceiver.track.id});De&&function(Ce,he){he.removeTrack(Ce),he.dispatchEvent(new r.MediaStreamTrackEvent("removetrack",{track:Ce}))}(De,te)}),P.associatedRemoteMediaStreams=[]),P.localCapabilities=ue,P.remoteCapabilities=ce,P.rtpReceiver=ae,P.rtcpParameters=fe,P.sendEncodingParameters=I,P.recvEncodingParameters=W,i._transceive(i.transceivers[x],!1,V)}}}),i._dtlsRole===void 0&&(i._dtlsRole=t.type==="offer"?"active":"passive"),i._remoteDescription={type:t.type,sdp:t.sdp},t.type==="offer"?i._updateSignalingState("have-remote-offer"):i._updateSignalingState("stable"),Object.keys(a).forEach(function(D){var x=a[D];if(x.getTracks().length){if(i.remoteStreams.indexOf(x)===-1){i.remoteStreams.push(x);var ne=new Event("addstream");ne.stream=x,r.setTimeout(function(){i._dispatchEvent("addstream",ne)})}p.forEach(function(Q){var B=Q[0],k=Q[1];x.id===Q[2].id&&v(i,B,k,[x])})}}),p.forEach(function(D){D[2]||v(i,D[0],D[1],[])}),r.setTimeout(function(){i&&i.transceivers&&i.transceivers.forEach(function(D){D.iceTransport&&D.iceTransport.state==="new"&&D.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),D.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},s.prototype.close=function(){this.transceivers.forEach(function(t){t.iceTransport&&t.iceTransport.stop(),t.dtlsTransport&&t.dtlsTransport.stop(),t.rtpSender&&t.rtpSender.stop(),t.rtpReceiver&&t.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},s.prototype._updateSignalingState=function(t){this.signalingState=t;var i=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",i)},s.prototype._maybeFireNegotiationNeeded=function(){var t=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,r.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var i=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",i)}},0))},s.prototype._updateIceConnectionState=function(){var t,i={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(p){p.iceTransport&&!p.rejected&&i[p.iceTransport.state]++}),t="new",i.failed>0?t="failed":i.checking>0?t="checking":i.disconnected>0?t="disconnected":i.new>0?t="new":i.connected>0?t="connected":i.completed>0&&(t="completed"),t!==this.iceConnectionState){this.iceConnectionState=t;var a=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",a)}},s.prototype._updateConnectionState=function(){var t,i={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(p){p.iceTransport&&p.dtlsTransport&&!p.rejected&&(i[p.iceTransport.state]++,i[p.dtlsTransport.state]++)}),i.connected+=i.completed,t="new",i.failed>0?t="failed":i.connecting>0?t="connecting":i.disconnected>0?t="disconnected":i.new>0?t="new":i.connected>0&&(t="connected"),t!==this.connectionState){this.connectionState=t;var a=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",a)}},s.prototype.createOffer=function(){var t=this;if(t._isClosed)return Promise.reject(d("InvalidStateError","Can not call createOffer after close"));var i=t.transceivers.filter(function(b){return b.kind==="audio"}).length,a=t.transceivers.filter(function(b){return b.kind==="video"}).length,p=arguments[0];if(p){if(p.mandatory||p.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");p.offerToReceiveAudio!==void 0&&(i=p.offerToReceiveAudio===!0?1:p.offerToReceiveAudio===!1?0:p.offerToReceiveAudio),p.offerToReceiveVideo!==void 0&&(a=p.offerToReceiveVideo===!0?1:p.offerToReceiveVideo===!1?0:p.offerToReceiveVideo)}for(t.transceivers.forEach(function(b){b.kind==="audio"?--i<0&&(b.wantReceive=!1):b.kind==="video"&&--a<0&&(b.wantReceive=!1)});i>0||a>0;)i>0&&(t._createTransceiver("audio"),i--),a>0&&(t._createTransceiver("video"),a--);var y=u.writeSessionBoilerplate(t._sdpSessionId,t._sdpSessionVersion++);t.transceivers.forEach(function(b,E){var O=b.track,D=b.kind,x=b.mid||u.generateIdentifier();b.mid=x,b.iceGatherer||(b.iceGatherer=t._createIceGatherer(E,t.usingBundle));var ne=r.RTCRtpSender.getCapabilities(D);g<15019&&(ne.codecs=ne.codecs.filter(function(B){return B.name!=="rtx"})),ne.codecs.forEach(function(B){B.name==="H264"&&B.parameters["level-asymmetry-allowed"]===void 0&&(B.parameters["level-asymmetry-allowed"]="1"),b.remoteCapabilities&&b.remoteCapabilities.codecs&&b.remoteCapabilities.codecs.forEach(function(k){B.name.toLowerCase()===k.name.toLowerCase()&&B.clockRate===k.clockRate&&(B.preferredPayloadType=k.payloadType)})}),ne.headerExtensions.forEach(function(B){(b.remoteCapabilities&&b.remoteCapabilities.headerExtensions||[]).forEach(function(k){B.uri===k.uri&&(B.id=k.id)})});var Q=b.sendEncodingParameters||[{ssrc:1001*(2*E+1)}];O&&g>=15019&&D==="video"&&!Q[0].rtx&&(Q[0].rtx={ssrc:Q[0].ssrc+1}),b.wantReceive&&(b.rtpReceiver=new r.RTCRtpReceiver(b.dtlsTransport,D)),b.localCapabilities=ne,b.sendEncodingParameters=Q}),t._config.bundlePolicy!=="max-compat"&&(y+="a=group:BUNDLE "+t.transceivers.map(function(b){return b.mid}).join(" ")+`\r
`),y+=`a=ice-options:trickle\r
`,t.transceivers.forEach(function(b,E){y+=n(b,b.localCapabilities,"offer",b.stream,t._dtlsRole),y+=`a=rtcp-rsize\r
`,!b.iceGatherer||t.iceGatheringState==="new"||E!==0&&t.usingBundle||(b.iceGatherer.getLocalCandidates().forEach(function(O){O.component=1,y+="a="+u.writeCandidate(O)+`\r
`}),b.iceGatherer.state==="completed"&&(y+=`a=end-of-candidates\r
`))});var R=new r.RTCSessionDescription({type:"offer",sdp:y});return Promise.resolve(R)},s.prototype.createAnswer=function(){var t=this;if(t._isClosed)return Promise.reject(d("InvalidStateError","Can not call createAnswer after close"));if(t.signalingState!=="have-remote-offer"&&t.signalingState!=="have-local-pranswer")return Promise.reject(d("InvalidStateError","Can not call createAnswer in signalingState "+t.signalingState));var i=u.writeSessionBoilerplate(t._sdpSessionId,t._sdpSessionVersion++);t.usingBundle&&(i+="a=group:BUNDLE "+t.transceivers.map(function(y){return y.mid}).join(" ")+`\r
`),i+=`a=ice-options:trickle\r
`;var a=u.getMediaSections(t._remoteDescription.sdp).length;t.transceivers.forEach(function(y,R){if(!(R+1>a)){if(y.rejected)return y.kind==="application"?y.protocol==="DTLS/SCTP"?i+=`m=application 0 DTLS/SCTP 5000\r
`:i+="m=application 0 "+y.protocol+` webrtc-datachannel\r
`:y.kind==="audio"?i+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:y.kind==="video"&&(i+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(i+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+y.mid+`\r
`);var b;y.stream&&(y.kind==="audio"?b=y.stream.getAudioTracks()[0]:y.kind==="video"&&(b=y.stream.getVideoTracks()[0]),b&&g>=15019&&y.kind==="video"&&!y.sendEncodingParameters[0].rtx&&(y.sendEncodingParameters[0].rtx={ssrc:y.sendEncodingParameters[0].ssrc+1}));var E=o(y.localCapabilities,y.remoteCapabilities);!E.codecs.filter(function(O){return O.name.toLowerCase()==="rtx"}).length&&y.sendEncodingParameters[0].rtx&&delete y.sendEncodingParameters[0].rtx,i+=n(y,E,"answer",y.stream,t._dtlsRole),y.rtcpParameters&&y.rtcpParameters.reducedSize&&(i+=`a=rtcp-rsize\r
`)}});var p=new r.RTCSessionDescription({type:"answer",sdp:i});return Promise.resolve(p)},s.prototype.addIceCandidate=function(t){var i,a=this;return t&&t.sdpMLineIndex===void 0&&!t.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(p,y){if(!a._remoteDescription)return y(d("InvalidStateError","Can not add ICE candidate without a remote description"));if(t&&t.candidate!==""){var R=t.sdpMLineIndex;if(t.sdpMid){for(var b=0;b<a.transceivers.length;b++)if(a.transceivers[b].mid===t.sdpMid){R=b;break}}var E=a.transceivers[R];if(!E)return y(d("OperationError","Can not add ICE candidate"));if(E.rejected)return p();var O=Object.keys(t.candidate).length>0?u.parseCandidate(t.candidate):{};if(O.protocol==="tcp"&&(O.port===0||O.port===9)||O.component&&O.component!==1)return p();if((R===0||R>0&&E.iceTransport!==a.transceivers[0].iceTransport)&&!c(E.iceTransport,O))return y(d("OperationError","Can not add ICE candidate"));var D=t.candidate.trim();D.indexOf("a=")===0&&(D=D.substr(2)),(i=u.getMediaSections(a._remoteDescription.sdp))[R]+="a="+(O.type?D:"end-of-candidates")+`\r
`,a._remoteDescription.sdp=u.getDescription(a._remoteDescription.sdp)+i.join("")}else for(var x=0;x<a.transceivers.length&&(a.transceivers[x].rejected||(a.transceivers[x].iceTransport.addRemoteCandidate({}),(i=u.getMediaSections(a._remoteDescription.sdp))[x]+=`a=end-of-candidates\r
`,a._remoteDescription.sdp=u.getDescription(a._remoteDescription.sdp)+i.join(""),!a.usingBundle));x++);p()})},s.prototype.getStats=function(t){if(t&&t instanceof r.MediaStreamTrack){var i=null;if(this.transceivers.forEach(function(p){p.rtpSender&&p.rtpSender.track===t?i=p.rtpSender:p.rtpReceiver&&p.rtpReceiver.track===t&&(i=p.rtpReceiver)}),!i)throw d("InvalidAccessError","Invalid selector.");return i.getStats()}var a=[];return this.transceivers.forEach(function(p){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(y){p[y]&&a.push(p[y].getStats())})}),Promise.all(a).then(function(p){var y=new Map;return p.forEach(function(R){R.forEach(function(b){y.set(b.id,b)})}),y})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var i=r[t];if(i&&i.prototype&&i.prototype.getStats){var a=i.prototype.getStats;i.prototype.getStats=function(){return a.apply(this).then(function(p){var y=new Map;return Object.keys(p).forEach(function(R){var b;p[R].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(b=p[R]).type]||b.type,y.set(R,p[R])}),y})}}});var f=["createOffer","createAnswer"];return f.forEach(function(t){var i=s.prototype[t];s.prototype[t]=function(){var a=arguments;return typeof a[0]=="function"||typeof a[1]=="function"?i.apply(this,[arguments[2]]).then(function(p){typeof a[0]=="function"&&a[0].apply(null,[p])},function(p){typeof a[1]=="function"&&a[1].apply(null,[p])}):i.apply(this,arguments)}}),(f=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(t){var i=s.prototype[t];s.prototype[t]=function(){var a=arguments;return typeof a[1]=="function"||typeof a[2]=="function"?i.apply(this,arguments).then(function(){typeof a[1]=="function"&&a[1].apply(null)},function(p){typeof a[2]=="function"&&a[2].apply(null,[p])}):i.apply(this,arguments)}}),["getStats"].forEach(function(t){var i=s.prototype[t];s.prototype[t]=function(){var a=arguments;return typeof a[1]=="function"?i.apply(this,arguments).then(function(){typeof a[1]=="function"&&a[1].apply(null)}):i.apply(this,arguments)}}),s}},function(j,Y,_){j.exports=function(u){var n=u&&u.navigator,o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return o(e).catch(function(c){return Promise.reject(function(d){return{name:{PermissionDeniedError:"NotAllowedError"}[d.name]||d.name,message:d.message,constraint:d.constraint,toString:function(){return this.name}}}(c))})}}},function(j,Y,_){var u=_(1);j.exports={shimGetUserMedia:_(14),shimOnTrack:function(n){typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)&&Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(o){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=o),this.addEventListener("addstream",this._ontrackpoly=(function(e){e.stream.getTracks().forEach((function(c){var d=new Event("track");d.track=c,d.receiver={track:c},d.transceiver={receiver:d.receiver},d.streams=[e.stream],this.dispatchEvent(d)}).bind(this))}).bind(this))},enumerable:!0,configurable:!0}),typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(n){typeof n=="object"&&n.HTMLMediaElement&&!("srcObject"in n.HTMLMediaElement.prototype)&&Object.defineProperty(n.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(o){this.mozSrcObject=o}})},shimPeerConnection:function(n){var o=u.detectBrowser(n);if(typeof n=="object"&&(n.RTCPeerConnection||n.mozRTCPeerConnection)){n.RTCPeerConnection||(n.RTCPeerConnection=function(r,g){if(o.version<38&&r&&r.iceServers){for(var h=[],v=0;v<r.iceServers.length;v++){var s=r.iceServers[v];if(s.hasOwnProperty("urls"))for(var f=0;f<s.urls.length;f++){var t={url:s.urls[f]};s.urls[f].indexOf("turn")===0&&(t.username=s.username,t.credential=s.credential),h.push(t)}else h.push(r.iceServers[v])}r.iceServers=h}return new n.mozRTCPeerConnection(r,g)},n.RTCPeerConnection.prototype=n.mozRTCPeerConnection.prototype,n.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:function(){return n.mozRTCPeerConnection.generateCertificate}}),n.RTCSessionDescription=n.mozRTCSessionDescription,n.RTCIceCandidate=n.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){var g=n.RTCPeerConnection.prototype[r];n.RTCPeerConnection.prototype[r]=function(){return arguments[0]=new(r==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),g.apply(this,arguments)}});var e=n.RTCPeerConnection.prototype.addIceCandidate;n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var c={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},d=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(r,g,h){return d.apply(this,[r||null]).then(function(v){if(o.version<48&&(v=function(s){var f=new Map;return Object.keys(s).forEach(function(t){f.set(t,s[t]),f[t]=s[t]}),f}(v)),o.version<53&&!g)try{v.forEach(function(s){s.type=c[s.type]||s.type})}catch(s){if(s.name!=="TypeError")throw s;v.forEach(function(f,t){v.set(t,Object.assign({},f,{type:c[f.type]||f.type}))})}return v}).then(g,h)}}},shimSenderGetStats:function(n){if(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&(!n.RTCRtpSender||!("getStats"in n.RTCRtpSender.prototype))){var o=n.RTCPeerConnection.prototype.getSenders;o&&(n.RTCPeerConnection.prototype.getSenders=function(){var c=this,d=o.apply(c,[]);return d.forEach(function(r){r._pc=c}),d});var e=n.RTCPeerConnection.prototype.addTrack;e&&(n.RTCPeerConnection.prototype.addTrack=function(){var c=e.apply(this,arguments);return c._pc=this,c}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(n){if(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&(!n.RTCRtpSender||!("getStats"in n.RTCRtpReceiver.prototype))){var o=n.RTCPeerConnection.prototype.getReceivers;o&&(n.RTCPeerConnection.prototype.getReceivers=function(){var e=this,c=o.apply(e,[]);return c.forEach(function(d){d._pc=e}),c}),u.wrapPeerConnectionEvent(n,"track",function(e){return e.receiver._pc=e.srcElement,e}),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(n){n.RTCPeerConnection&&!("removeStream"in n.RTCPeerConnection.prototype)&&(n.RTCPeerConnection.prototype.removeStream=function(o){var e=this;u.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(c){c.track&&o.getTracks().indexOf(c.track)!==-1&&e.removeTrack(c)})})},shimRTCDataChannel:function(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)},shimGetDisplayMedia:function(n,o){n.navigator&&n.navigator.mediaDevices&&!("getDisplayMedia"in n.navigator.mediaDevices)&&(n.navigator.mediaDevices.getDisplayMedia=function(e){if(!e||!e.video){var c=new DOMException("getDisplayMedia without video constraints is undefined");return c.name="NotFoundError",c.code=8,Promise.reject(c)}return e.video===!0?e.video={mediaSource:o}:e.video.mediaSource=o,n.navigator.mediaDevices.getUserMedia(e)},n.navigator.getDisplayMedia=function(e){return u.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),n.navigator.mediaDevices.getDisplayMedia(e)})}}},function(j,Y,_){var u=_(1),n=u.log;j.exports=function(o){var e=u.detectBrowser(o),c=o&&o.navigator,d=o&&o.MediaStreamTrack,r=function(a){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[a.name]||a.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[a.message]||a.message,constraint:a.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},g=function(a,p,y){var R=function(b){if(typeof b!="object"||b.require)return b;var E=[];return Object.keys(b).forEach(function(O){if(O!=="require"&&O!=="advanced"&&O!=="mediaSource"){var D=b[O]=typeof b[O]=="object"?b[O]:{ideal:b[O]};if(D.min===void 0&&D.max===void 0&&D.exact===void 0||E.push(O),D.exact!==void 0&&(typeof D.exact=="number"?D.min=D.max=D.exact:b[O]=D.exact,delete D.exact),D.ideal!==void 0){b.advanced=b.advanced||[];var x={};typeof D.ideal=="number"?x[O]={min:D.ideal,max:D.ideal}:x[O]=D.ideal,b.advanced.push(x),delete D.ideal,Object.keys(D).length||delete b[O]}}}),E.length&&(b.require=E),b};return a=JSON.parse(JSON.stringify(a)),e.version<38&&(n("spec: "+JSON.stringify(a)),a.audio&&(a.audio=R(a.audio)),a.video&&(a.video=R(a.video)),n("ff37: "+JSON.stringify(a))),c.mozGetUserMedia(a,p,function(b){y(r(b))})};if(c.mediaDevices||(c.mediaDevices={getUserMedia:function(a){return new Promise(function(p,y){g(a,p,y)})},addEventListener:function(){},removeEventListener:function(){}}),c.mediaDevices.enumerateDevices=c.mediaDevices.enumerateDevices||function(){return new Promise(function(a){a([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},e.version<41){var h=c.mediaDevices.enumerateDevices.bind(c.mediaDevices);c.mediaDevices.enumerateDevices=function(){return h().then(void 0,function(a){if(a.name==="NotFoundError")return[];throw a})}}if(e.version<49){var v=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(a){return v(a).then(function(p){if(a.audio&&!p.getAudioTracks().length||a.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(function(y){y.stop()}),new DOMException("The object can not be found here.","NotFoundError");return p},function(p){return Promise.reject(r(p))})}}if(!(e.version>55&&"autoGainControl"in c.mediaDevices.getSupportedConstraints())){var s=function(a,p,y){p in a&&!(y in a)&&(a[y]=a[p],delete a[p])},f=c.mediaDevices.getUserMedia.bind(c.mediaDevices);if(c.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a.audio,"autoGainControl","mozAutoGainControl"),s(a.audio,"noiseSuppression","mozNoiseSuppression")),f(a)},d&&d.prototype.getSettings){var t=d.prototype.getSettings;d.prototype.getSettings=function(){var a=t.apply(this,arguments);return s(a,"mozAutoGainControl","autoGainControl"),s(a,"mozNoiseSuppression","noiseSuppression"),a}}if(d&&d.prototype.applyConstraints){var i=d.prototype.applyConstraints;d.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a,"autoGainControl","mozAutoGainControl"),s(a,"noiseSuppression","mozNoiseSuppression")),i.apply(this,[a])}}}c.getUserMedia=function(a,p,y){if(e.version<44)return g(a,p,y);u.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),c.mediaDevices.getUserMedia(a).then(p,y)}}},function(j,Y,_){var u=_(1);j.exports={shimLocalStreamsAPI:function(n){if(typeof n=="object"&&n.RTCPeerConnection){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getStreamById=function(e){var c=null;return this._localStreams&&this._localStreams.forEach(function(d){d.id===e&&(c=d)}),this._remoteStreams&&this._remoteStreams.forEach(function(d){d.id===e&&(c=d)}),c}),!("addStream"in n.RTCPeerConnection.prototype)){var o=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.indexOf(e)===-1&&this._localStreams.push(e);var c=this;e.getTracks().forEach(function(d){o.call(c,d,e)})},n.RTCPeerConnection.prototype.addTrack=function(e,c){return c&&(this._localStreams?this._localStreams.indexOf(c)===-1&&this._localStreams.push(c):this._localStreams=[c]),o.call(this,e,c)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var c=this._localStreams.indexOf(e);if(c!==-1){this._localStreams.splice(c,1);var d=this,r=e.getTracks();this.getSenders().forEach(function(g){r.indexOf(g.track)!==-1&&d.removeTrack(g)})}})}},shimRemoteStreamsAPI:function(n){if(typeof n=="object"&&n.RTCPeerConnection&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=e)}});var o=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(c){c.streams.forEach(function(d){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(d)>=0)){e._remoteStreams.push(d);var r=new Event("addstream");r.stream=d,e.dispatchEvent(r)}})}),o.apply(e,arguments)}}},shimCallbacksAPI:function(n){if(typeof n=="object"&&n.RTCPeerConnection){var o=n.RTCPeerConnection.prototype,e=o.createOffer,c=o.createAnswer,d=o.setLocalDescription,r=o.setRemoteDescription,g=o.addIceCandidate;o.createOffer=function(v,s){var f=arguments.length>=2?arguments[2]:arguments[0],t=e.apply(this,[f]);return s?(t.then(v,s),Promise.resolve()):t},o.createAnswer=function(v,s){var f=arguments.length>=2?arguments[2]:arguments[0],t=c.apply(this,[f]);return s?(t.then(v,s),Promise.resolve()):t};var h=function(v,s,f){var t=d.apply(this,[v]);return f?(t.then(s,f),Promise.resolve()):t};o.setLocalDescription=h,h=function(v,s,f){var t=r.apply(this,[v]);return f?(t.then(s,f),Promise.resolve()):t},o.setRemoteDescription=h,h=function(v,s,f){var t=g.apply(this,[v]);return f?(t.then(s,f),Promise.resolve()):t},o.addIceCandidate=h}},shimGetUserMedia:function(n){var o=n&&n.navigator;o.getUserMedia||(o.webkitGetUserMedia?o.getUserMedia=o.webkitGetUserMedia.bind(o):o.mediaDevices&&o.mediaDevices.getUserMedia&&(o.getUserMedia=(function(e,c,d){o.mediaDevices.getUserMedia(e).then(c,d)}).bind(o)))},shimRTCIceServerUrls:function(n){var o=n.RTCPeerConnection;n.RTCPeerConnection=function(e,c){if(e&&e.iceServers){for(var d=[],r=0;r<e.iceServers.length;r++){var g=e.iceServers[r];!g.hasOwnProperty("urls")&&g.hasOwnProperty("url")?(u.deprecated("RTCIceServer.url","RTCIceServer.urls"),(g=JSON.parse(JSON.stringify(g))).urls=g.url,delete g.url,d.push(g)):d.push(e.iceServers[r])}e.iceServers=d}return new o(e,c)},n.RTCPeerConnection.prototype=o.prototype,"generateCertificate"in n.RTCPeerConnection&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:function(){return o.generateCertificate}})},shimTrackEventTransceiver:function(n){typeof n=="object"&&n.RTCPeerConnection&&"receiver"in n.RTCTrackEvent.prototype&&!n.RTCTransceiver&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(n){var o=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(e){var c=this;if(e){e.offerToReceiveAudio!==void 0&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var d=c.getTransceivers().find(function(g){return g.sender.track&&g.sender.track.kind==="audio"});e.offerToReceiveAudio===!1&&d?d.direction==="sendrecv"?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":d.direction==="recvonly"&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):e.offerToReceiveAudio!==!0||d||c.addTransceiver("audio"),e.offerToReceiveVideo!==void 0&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=c.getTransceivers().find(function(g){return g.sender.track&&g.sender.track.kind==="video"});e.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection("sendonly"):r.direction==="recvonly"&&r.setDirection("inactive"):e.offerToReceiveVideo!==!0||r||c.addTransceiver("video")}return o.apply(c,arguments)}}}},function(j,Y,_){var u=_(2),n=_(1);j.exports={shimRTCIceCandidate:function(o){if(!(!o.RTCIceCandidate||o.RTCIceCandidate&&"foundation"in o.RTCIceCandidate.prototype)){var e=o.RTCIceCandidate;o.RTCIceCandidate=function(c){if(typeof c=="object"&&c.candidate&&c.candidate.indexOf("a=")===0&&((c=JSON.parse(JSON.stringify(c))).candidate=c.candidate.substr(2)),c.candidate&&c.candidate.length){var d=new e(c),r=u.parseCandidate(c.candidate),g=Object.assign(d,r);return g.toJSON=function(){return{candidate:g.candidate,sdpMid:g.sdpMid,sdpMLineIndex:g.sdpMLineIndex,usernameFragment:g.usernameFragment}},g}return new e(c)},o.RTCIceCandidate.prototype=e.prototype,n.wrapPeerConnectionEvent(o,"icecandidate",function(c){return c.candidate&&Object.defineProperty(c,"candidate",{value:new o.RTCIceCandidate(c.candidate),writable:"false"}),c})}},shimCreateObjectURL:function(o){var e=o&&o.URL;if(typeof o=="object"&&o.HTMLMediaElement&&"srcObject"in o.HTMLMediaElement.prototype&&e.createObjectURL&&e.revokeObjectURL){var c=e.createObjectURL.bind(e),d=e.revokeObjectURL.bind(e),r=new Map,g=0;e.createObjectURL=function(s){if("getTracks"in s){var f="polyblob:"+ ++g;return r.set(f,s),n.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),f}return c(s)},e.revokeObjectURL=function(s){d(s),r.delete(s)};var h=Object.getOwnPropertyDescriptor(o.HTMLMediaElement.prototype,"src");Object.defineProperty(o.HTMLMediaElement.prototype,"src",{get:function(){return h.get.apply(this)},set:function(s){return this.srcObject=r.get(s)||null,h.set.apply(this,[s])}});var v=o.HTMLMediaElement.prototype.setAttribute;o.HTMLMediaElement.prototype.setAttribute=function(){return arguments.length===2&&(""+arguments[0]).toLowerCase()==="src"&&(this.srcObject=r.get(arguments[1])||null),v.apply(this,arguments)}}},shimMaxMessageSize:function(o){if(!o.RTCSctpTransport&&o.RTCPeerConnection){var e=n.detectBrowser(o);"sctp"in o.RTCPeerConnection.prototype||Object.defineProperty(o.RTCPeerConnection.prototype,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp}});var c=function(v){var s=u.splitSections(v.sdp);return s.shift(),s.some(function(f){var t=u.parseMLine(f);return t&&t.kind==="application"&&t.protocol.indexOf("SCTP")!==-1})},d=function(v){var s=v.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(s===null||s.length<2)return-1;var f=parseInt(s[1],10);return f!=f?-1:f},r=function(v){var s=65536;return e.browser==="firefox"&&(s=e.version<57?v===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),s},g=function(v,s){var f=65536;e.browser==="firefox"&&e.version===57&&(f=65535);var t=u.matchPrefix(v.sdp,"a=max-message-size:");return t.length>0?f=parseInt(t[0].substr(19),10):e.browser==="firefox"&&s!==-1&&(f=2147483637),f},h=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){var v=this;if(v._sctp=null,c(arguments[0])){var s,f=d(arguments[0]),t=r(f),i=g(arguments[0],f);s=t===0&&i===0?Number.POSITIVE_INFINITY:t===0||i===0?Math.max(t,i):Math.min(t,i);var a={};Object.defineProperty(a,"maxMessageSize",{get:function(){return s}}),v._sctp=a}return h.apply(v,arguments)}}},shimSendThrowTypeError:function(o){if(o.RTCPeerConnection&&"createDataChannel"in o.RTCPeerConnection.prototype){var e=o.RTCPeerConnection.prototype.createDataChannel;o.RTCPeerConnection.prototype.createDataChannel=function(){var d=this,r=e.apply(d,arguments);return c(r,d),r},n.wrapPeerConnectionEvent(o,"datachannel",function(d){return c(d.channel,d.target),d})}function c(d,r){var g=d.send;d.send=function(){var h=arguments[0],v=h.length||h.size||h.byteLength;if(d.readyState==="open"&&r.sctp&&v>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return g.apply(d,arguments)}}}}},function(j,Y,_){_.r(Y),typeof console<"u"&&console.log!==void 0||(console={log:function(){}});var u=function(){},n=function(){},o=function(){},e=function(){},c=function(){},d=function(){};d=console.error.bind(console);var r={trace:u,debug:n,vdebug:o,log:e,warn:c,error:d},g=_(0),h=_.n(g);function v(l){return(v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C})(l)}var s=null,f=null,t=null,i=!1,a=null,p=null,y=null,R=function(l){switch(l.response){case"keepalive":r.vdebug("Got a keepalive");break;case"ack":r.debug("Got an ack"),r.debug(l);break;case"success":r.debug("Got a success"),r.debug(l),p(l);break;case"closed":r.debug("Got a closed connection"),r.debug(l),y();break;case"offline":r.debug("Connection is offline, token expired"),r.debug(l),f("offline");break;case"trickle":if(!I()&&!W())return void r.debug("This handle is not attached to this session");var C=l.candidate,m=a.webrtcConfig;r.debug("Got a trickled candidate"),r.debug(C),m.pc&&m.remoteSdp?(r.debug("Adding remote candidate:",C),C&&C.completed!==!0?m.pc.addIceCandidate(new RTCIceCandidate(C)):m.pc.addIceCandidate()):(r.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),m.candidates||(m.candidates=[]),m.candidates.push(C),r.debug(m.candidates));break;case"webrtcup":if(!I())return void r.debug("This handle is not attached");a.webrtcState(!0);break;case"hangup":if(r.debug("Got a hangup event"),r.debug(l),!I())return void r.debug("This handle is not attached");a.webrtcState(!1,l.reason),a.hangup();break;case"media":if(r.debug("Got a media event"),r.debug(l),!I())return void r.debug("This handle is not attached");a.mediaState(l.type,l.receiving);break;case"slowlink":if(r.debug("Got a slowlink event"),r.debug(l),!I())return void r.debug("This handle is not attached");a.slowLink(l.uplink,l.nacks);break;case"error":r.error("AfricasTalking Client Error: "+l.error.code+" "+l.error.reason),r.debug(l);break;case"event":if(r.log("Got an event"),r.log(l),l.eventdata===void 0||l.eventdata===null)return void r.warn("Missing eventdata...");if(r.log(l.eventdata),!I())return void r.warn("This handle is not attachedddd");l.jsep!==void 0&&l.jsep!==null&&(r.log("Handling SDP as well..."),r.log(l.jsep)),a.onmessage!==null&&a.onmessage!==void 0?(r.log("Notifying application..."),a.onmessage(l.eventdata,l.jsep)):r.debug("No provided notification callback");break;default:r.warn("Unknown message/event  "+l),r.debug(l)}},b=function(l){if(!i)return r.warn("Is the gateway down? (connected=false)"),void l.error("Is the gateway down? (connected=false)");if(!I()&&!W())return r.warn("Invalid handle"),void l.error("Invalid handle");var C=l.message,m=l.jsep,S={command:"message",body:C};m!=null&&(S.jsep=m),r.debug("Sending message to web socket"),r.debug(S),r.debug("Sending a request to Africa's Talking"+S),s.send(JSON.stringify(S))},E=function(l){if(!I()&&!W())return r.warn("Invalid handle"),void l.error("Invalid handle");var C=a.webrtcConfig,m=l.text;if(m==null)return r.warn("Invalid text"),void l.error("Invalid text");r.log("Sending string on data channel: "+m),C.dataChannel.send(m),l.success()},O=function(l){var C=l.jsep;l.media=l.media||{audio:!0};var m=l.media;if(!I()&&!W())return r.warn("Invalid handle"),void l.error("Invalid handle");var S=a.webrtcConfig;if(S.pc===void 0||S.pc===null)r.log("Creating a new media session"),m.update=!1;else if(S.pc!==void 0&&S.pc!==null)if(r.log("Updating existing media session"),m.update=!0,l.stream!==null&&l.stream!==void 0)l.stream!==S.myStream&&r.log("Renegotiation involves a new external stream");else{if(m.addAudio){if(m.replaceAudio=!1,m.removeAudio=!1,m.audioSend=!0,S.myStream&&S.myStream.getAudioTracks()&&S.myStream.getAudioTracks().length)return r.error("AfricasTalking Client Error: Can't add audio stream, there already is one"),void l.error("AfricasTalking Client Error: Can't add audio stream, there already is one")}else m.removeAudio?(m.replaceAudio=!1,m.addAudio=!1,m.audioSend=!1):m.replaceAudio&&(m.addAudio=!1,m.removeAudio=!1,m.audioSend=!0);S.myStream===null||S.myStream===void 0?(m.replaceAudio&&(m.replaceAudio=!1,m.addAudio=!0,m.audioSend=!0),X(m)&&(m.addAudio=!0)):S.myStream.getAudioTracks()!==null&&S.myStream.getAudioTracks()!==void 0&&S.myStream.getAudioTracks().length!==0||(m.replaceAudio&&(m.replaceAudio=!1,m.addAudio=!0,m.audioSend=!0),X(m)&&(m.addAudio=!0))}if(m.update&&!S.streamExternal&&(m.removeAudio||m.replaceAudio)){if(S.myStream&&S.myStream.getAudioTracks()&&S.myStream.getAudioTracks().length){var T=S.myStream.getAudioTracks()[0];r.log("Removing audio track:",T),S.myStream.removeTrack(T);try{T.stop()}catch(G){r.log("Error removing audio track:",G)}}if(S.pc.getSenders()&&S.pc.getSenders().length&&!m.replaceAudio&&h.a.browserDetails.browser==="firefox")for(var L in S.pc.getSenders()){var J=S.pc.getSenders()[L];J&&J.track&&J.track.kind==="audio"&&(r.log("Removing audio sender:",J),S.pc.removeTrack(J))}}if(l.stream!==null&&l.stream!==void 0){var H=l.stream;if(r.log("MediaStream provided by the application"),r.debug(H),m.update&&S.myStream&&S.myStream!==l.stream&&!S.streamExternal){try{var N=S.myStream.getTracks();for(var re in N){var K=N[re];r.log(K),K!=null&&K.stop()}}catch{}S.myStream=null}return S.streamExternal=!0,void B(C,m,l,H)}if(r.log("Executing isAudioSendEnabled"),X(m)){a.consentDialog(!0);var $=X(m);$===!0&&m!=null&&m!=null&&v(m.audio)==="object"&&($=m.audio),m!=null&&m.video==="screen"||navigator.mediaDevices.enumerateDevices().then(function(G){var de=G.some(function(me){return me.kind==="audioinput"}),ie=X(m),le=se(m);if((ie||le)&&!(ie&&de)&&le)return a.consentDialog(!1),l.error("Audio capture is required, but no capture device found"),!1;var Se={audio:!!de&&$,video:!1};r.debug("getUserMedia constraints",Se),navigator.mediaDevices.getUserMedia(Se).then(function(me){a.consentDialog(!1),B(C,m,l,me)}).catch(function(me){a.consentDialog(!1),l.error({code:me.code,name:me.name,message:me.message})})}).catch(function(G){a.consentDialog(!1),l.error("enumerateDevices error",G)})}else B(C,m,l)},D=function(l){var C=l.jsep;if(!I()&&!W())return r.warn("Invalid handle"),void l.error("Invalid handle");var m=a.webrtcConfig;if(C!=null){if(m.pc===null)return r.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void l.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");m.pc.setRemoteDescription(new RTCSessionDescription(C),function(){if(r.log("Remote description accepted!"),m.remoteSdp=C.sdp,m.candidates&&m.candidates.length>0){for(var S in m.candidates){var T=m.candidates[S];r.debug("Adding remote candidate:",T),T&&T.completed!==!0?m.pc.addIceCandidate(new RTCIceCandidate(T)):m.pc.addIceCandidate()}m.candidates=[]}},l.error)}else l.error("Invalid JSEP")},x=function(){if(!I()&&!W())return r.warn("Invalid handle"),"Invalid handle";var l=a.webrtcConfig;return l.pc===null||l.pc===void 0?"Invalid PeerConnection":l.pc.getStats?l.bitrate.timer===null||l.bitrate.timer===void 0?(r.log("Starting bitrate timer (via getStats)"),l.bitrate.timer=setInterval(function(){l.pc.getStats().then(function(C){C.forEach(function(m){if(m){var S=!1;if((m.mediaType==="video"||m.id.toLowerCase().indexOf("video")>-1)&&m.type==="inbound-rtp"&&m.id.indexOf("rtcp")<0?S=!0:m.type!="ssrc"||!m.bytesReceived||m.googCodecName!=="VP8"&&m.googCodecName!==""||(S=!0),S)if(l.bitrate.bsnow=m.bytesReceived,l.bitrate.tsnow=m.timestamp,l.bitrate.bsbefore===null||l.bitrate.tsbefore===null)l.bitrate.bsbefore=l.bitrate.bsnow,l.bitrate.tsbefore=l.bitrate.tsnow;else{var T=l.bitrate.tsnow-l.bitrate.tsbefore;h.a.browserDetails.browser=="safari"&&(T/=1e3);var L=Math.round(8*(l.bitrate.bsnow-l.bitrate.bsbefore)/T);l.bitrate.value=L+" kbits/sec",l.bitrate.bsbefore=l.bitrate.bsnow,l.bitrate.tsbefore=l.bitrate.tsnow}}})})},1e3),"0 kbits/sec"):l.bitrate.value:(r.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser")},ne=function(l){if(!I()&&!W())return r.warn("Invalid handle"),void l.error("Invalid handle");var C=a.webrtcConfig;if(C.dtmfSender===null||C.dtmfSender===void 0){if(C.pc!==void 0&&C.pc!==null){var m=C.pc.getSenders().find(function(H){return H.track&&H.track.kind==="audio"});if(!m)return r.warn("Invalid DTMF configuration (no audio track)"),void l.error("Invalid DTMF configuration (no audio track)");C.dtmfSender=m.dtmf,C.dtmfSender&&(r.log("Created DTMF Sender"),C.dtmfSender.ontonechange=function(H){r.debug("Sent DTMF tone: "+H.tone)}),r.log({"config.dtmfSender":C.dtmfSender})}if(C.dtmfSender===null||C.dtmfSender===void 0)return r.warn("Invalid DTMF configuration"),void l.error("Invalid DTMF configuration")}var S=l.dtmf;if(S==null)return r.warn("Invalid DTMF parameters"),void l.error("Invalid DTMF parameters");var T=S.tones;if(T==null)return r.warn("Invalid DTMF string"),void l.error("Invalid DTMF string");var L=S.duration;L==null&&(L=500);var J=S.gap;J==null&&(J=50),r.debug("Sending DTMF string "+T+" (duration "+L+"ms, gap "+J+"ms)"),C.dtmfSender.insertDTMF(T,L,J)},Q=function(l){if(r.log("Cleaning WebRTC stuff"),I()){var C=a.webrtcConfig;if(C!=null){if(l===!0){var m={command:"hangup"};r.debug("Sending hangup request"),r.debug(m),s.send(JSON.stringify(m))}C.remoteStream=null,C.volume.timer&&clearInterval(C.volume.timer),C.volume.value=null,C.bitrate.timer&&clearInterval(C.bitrate.timer),C.bitrate.timer=null,C.bitrate.bsnow=null,C.bitrate.bsbefore=null,C.bitrate.tsnow=null,C.bitrate.tsbefore=null,C.bitrate.value=null;try{if(!C.streamExternal&&C.myStream!==null&&C.myStream!==void 0){r.log("Stopping local stream tracks");var S=C.myStream.getTracks();for(var T in S){var L=S[T];r.log(L),L!=null&&L.stop()}}}catch{}C.streamExternal=!1,C.myStream=null;try{C.pc.close()}catch{}C.pc=null,C.candidates=null,C.mySdp=null,C.remoteSdp=null,C.iceDone=!1,C.dataChannel=null,C.dtmfSender=null}a.oncleanup()}},B=function(l,C,m,S){if(!I()&&!W())return r.warn("Invalid handle"),void m.error("Invalid handle");var T=a.webrtcConfig;r.log("streamsDone:",S),S&&(r.debug("  -- Audio tracks:",S.getAudioTracks()),r.debug("  -- Video tracks:",S.getVideoTracks()));var L=!1;if(T.myStream&&C.update&&!T.streamExternal){if((!C.update&&X(C)||C.update&&(C.addAudio||C.replaceAudio))&&S.getAudioTracks()&&S.getAudioTracks().length)if(T.myStream.addTrack(S.getAudioTracks()[0]),C.replaceAudio&&h.a.browserDetails.browser==="firefox")for(var J in r.log("Adding audio track:",S.getAudioTracks()[0]),T.pc.getSenders()){var H=T.pc.getSenders()[J];H&&H.track&&H.track.kind==="audio"&&H.replaceTrack(S.getAudioTracks()[0])}else r.log((C.replaceAudio?"Replacing":"Adding")+" audio track:",S.getAudioTracks()[0]),T.pc.addTrack(S.getAudioTracks()[0],S)}else T.myStream=S,L=!0;if(!T.pc){var N={iceServers:m.iceServers,iceTransportPolicy:void 0,bundlePolicy:"balanced"},re={optional:[{DtlsSrtpKeyAgreement:!0}]};if(m.rtcConstraints&&v(m.rtcConstraints)==="object")for(var K in r.debug("Adding custom PeerConnection constraints:",m.rtcConstraints),m.rtcConstraints)re.optional.push(m.rtcConstraints[K]);h.a.browserDetails.browser==="edge"&&(N.bundlePolicy="max-bundle"),r.log("Creating PeerConnection"),r.debug(re),r.log("new RTCPeerConnection"+JSON.stringify({iceServers:N.iceServers,pc_constraints:re})),T.pc=new RTCPeerConnection(N,re),r.log("This is the peer connection created "+JSON.stringify(T.pc)),T.pc.getStats&&(T.volume.value=0,T.bitrate.value="0 kbits/sec"),r.log("Preparing local SDP and gathering candidates (trickle="+T.trickle+")"),T.pc.oniceconnectionstatechange=function(){T.pc&&a.iceState(T.pc.iceConnectionState)},T.pc.onicecandidate=function($){if($.candidate==null||h.a.browserDetails.browser==="edge"&&$.candidate.candidate.indexOf("endOfCandidates")>0)r.log("End of candidates."),T.iceDone=!0,T.trickle===!0?k(m,{completed:!0}):function(de){if(I()||W()){var ie=a.webrtcConfig;r.log("Sending offer/answer SDP..."),ie.mySdp!==null&&ie.mySdp!==void 0?(ie.mySdp={type:ie.pc.localDescription.type,sdp:ie.pc.localDescription.sdp},ie.trickle===!1&&(ie.mySdp.trickle=!1),r.debug(de),ie.sdpSent=!0,de.success(ie.mySdp)):r.warn("Local SDP instance is invalid, not sending anything...")}else r.warn("Invalid handle, not sending anything")}(m);else{var G={candidate:$.candidate.candidate,sdpMid:$.candidate.sdpMid,sdpMLineIndex:$.candidate.sdpMLineIndex};T.trickle===!0&&k(m,G)}},T.pc.ontrack=function($){r.log("Handling Remote Track"),r.debug($),$.streams&&(T.remoteStream=$.streams[0],a.onremotestream(T.remoteStream),$.track&&!$.track.onended&&(r.log("Adding onended callback to track:",$.track),$.track.onended=function(G){r.log("Remote track removed:",G),T.remoteStream&&(T.remoteStream.removeTrack(G.target),a.onremotestream(T.remoteStream))}))}}L&&S!=null&&(r.log("Adding local stream"),S.getTracks().forEach(function($){T.pc.addTrack($,S)})),T.myStream&&a.onlocalstream(T.myStream),l==null?function($,G){if(!I()&&!W())return r.warn("Invalid handle"),void G.error("Invalid handle");var de=a.webrtcConfig,ie=G.simulcast===!0;ie?r.log("Creating offer (iceDone="+de.iceDone+", simulcast="+ie+")"):r.log("Creating offer (iceDone="+de.iceDone+")");var le={offerToReceiveAudio:pe($)};G.iceRestart===!0&&(le.iceRestart=!0),r.log(le),de.pc.createOffer(function(Se){if(r.debug(Se),r.log("Setting local description"),de.mySdp=Se.sdp,de.pc.setLocalDescription(Se),de.mediaConstraints=le,de.iceDone||de.trickle){r.log("Offer ready"),r.debug(G);var me={type:Se.type,sdp:Se.sdp};G.success(me)}else r.log("Waiting for all candidates...")},G.error,le)}(C,m):T.pc.setRemoteDescription(new RTCSessionDescription(l),function(){if(r.log("Remote description accepted!"),T.remoteSdp=l.sdp,T.candidates&&T.candidates.length>0){for(var $ in T.candidates){var G=T.candidates[$];r.debug("Adding remote candidate:",G),G&&G.completed!==!0?T.pc.addIceCandidate(new RTCIceCandidate(G)):T.pc.addIceCandidate()}T.candidates=[]}(function(de,ie){if(!I()&&!W())return r.warn("Invalid handle"),void ie.error("Invalid handle");var le=a.webrtcConfig,Se=ie.simulcast===!0;Se?r.log("Creating answer (iceDone="+le.iceDone+", simulcast="+Se+")"):r.log("Creating answer (iceDone="+le.iceDone+")");var me=null;me=h.a.browserDetails.browser=="firefox"||h.a.browserDetails.browser=="edge"?{offerToReceiveAudio:pe(de)}:{mandatory:{OfferToReceiveAudio:pe(de)}},r.debug(me),le.pc.createAnswer(function(xe){if(r.debug(xe),r.log("Setting local description"),le.mySdp=xe.sdp,le.pc.setLocalDescription(xe),le.mediaConstraints=me,le.iceDone||le.trickle){var Be={type:xe.type,sdp:xe.sdp};ie.success(Be)}else r.log("Waiting for all candidates...")},ie.error,me)})(C,m)},m.error)},k=function(l,C){if(i){if(!I()&&!W())return r.warn("Invalid handle"),void l.error("Invalid handle");var m={command:"trickle",candidate:C};r.vdebug("Sending trickle candidate"),r.vdebug(m),s.send(JSON.stringify(m))}else r.warn("Is the gateway down? (connected=false)")},w=function(){if(!I()&&!W())return r.warn("Invalid handle"),!0;var l=a.webrtcConfig;return l.pc===null||l.pc===void 0?(r.warn("Invalid PeerConnection"),!0):l.myStream===void 0||l.myStream===null?(r.warn("Invalid local MediaStream"),!0):l.myStream.getAudioTracks()===null||l.myStream.getAudioTracks()===void 0||l.myStream.getAudioTracks().length===0?(r.warn("No audio track"),!0):!l.myStream.getAudioTracks()[0].enabled},M=function(l){if(!I()&&!W())return r.warn("Invalid handle"),!1;var C=a.webrtcConfig;return C.pc===null||C.pc===void 0?(r.warn("Invalid PeerConnection"),!1):C.myStream===void 0||C.myStream===null?(r.warn("Invalid local MediaStream"),!1):C.myStream.getAudioTracks()===null||C.myStream.getAudioTracks()===void 0||C.myStream.getAudioTracks().length===0?(r.warn("No audio track"),!1):(r.log({"config.myStream.getAudioTracks()[0].enabled":C.myStream.getAudioTracks()[0].enabled}),C.myStream.getAudioTracks()[0].enabled=!l,!0)},F=function(){if(!I()&&!W())return r.warn("Invalid handle"),!1;var l=a.webrtcConfig;return l.pc.getStats&&h.a.browserDetails.browser=="chrome"?l.remoteStream===null||l.remoteStream===void 0?(r.warn("Remote stream unavailable"),0):l.volume.timer===null||l.volume.timer===void 0?(r.log("Starting volume monitor"),l.volume.timer=setInterval(function(){l.pc.getStats(function(C){for(var m=C.result(),S=0;S<m.length;S++){var T=m[S];T.type=="ssrc"&&T.stat("audioOutputLevel")&&(l.volume.value=T.stat("audioOutputLevel"))}})},200),0):l.volume.value:(r.log("Getting the remote volume unsupported by browser"),0)},P=function(){var l=function(){s.removeEventListener("message",C),s.removeEventListener("error",m),t&&clearTimeout(t),s.close()},C=function(){r.log("websocket closed successfully"),l()},m=function(){r.log("closing websocket on error"),l()};f("closed"),s.readyState==1?(s.addEventListener("message",C),s.addEventListener("error",m),s.send(JSON.stringify({command:"destroy"}))):m()},X=function(l){return r.debug("isAudioSendEnabled:",l),l==null||l.audio!==!1&&(l.audioSend===void 0||l.audioSend===null||l.audioSend===!0)},se=function(l){return r.debug("isAudioSendRequired:",l),l!=null&&l.audio!==!1&&l.audioSend!==!1&&l.failIfNoAudio!==void 0&&l.failIfNoAudio!==null&&l.failIfNoAudio===!0},pe=function(l){return r.debug("isAudioRecvEnabled:",l),l==null||l.audio!==!1&&(l.audioRecv===void 0||l.audioRecv===null||l.audioRecv===!0)},ae=function l(){i&&(t=setTimeout(l,3e4),r.log("keepalive"),s.send(JSON.stringify({command:"keepalive"})))},I=function(){var l=!1;return a&&(l=!0),l},W=function(){var l=!1;return a.webrtcConfig&&(l=!0),l};function ue(l,C,m,S,T,L,J){try{var H=l[L](J),N=H.value}catch(re){return void m(re)}H.done?C(N):Promise.resolve(N).then(S,T)}var q=function(){var l,C=(l=regeneratorRuntime.mark(function m(S,T){return regeneratorRuntime.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.abrupt("return",new Promise(function(J,H){q.server=new WebSocket(S.server,["at-protocol",S.capabilityToken]),q.server.onopen=function(){var N,re;r.log("Sending initial request to Africa's Talking APIs "),N=T,re=q.server,s=re,f=N.emitEvent,y=function(){r.error("AfricasTalking Client Error: error occured on session creation"),P()},p=function(){r.log("Creating Session... ");var K={webrtcConfig:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},consentDialog:N.consentDialog,iceState:N.iceState,mediaState:N.mediaState,webrtcState:N.webrtcState,slowLink:N.slowLink,onmessage:N.onmessage,onlocalstream:N.onlocalstream,onremotestream:N.onremotestream,ondata:N.ondata,ondataopen:N.ondataopen,oncleanup:N.oncleanup,getVolume:function(){return F()},isAudioMuted:function(){return w()},muteAudio:function(){return M(!0)},unmuteAudio:function(){return M(!1)},getBitrate:function(){return x()},send:function(G){b(G)},data:function(G){E(G)},dtmf:function(G){ne(G)},createOffer:function(G){O(G)},createAnswer:function(G){O(G)},handleRemoteJsep:function(G){D(G)},hangup:function(G){Q(G===!0)}};r.log({"my handle is":K}),t=setTimeout(ae,3e4),i=!0,a=K,N.setHandle(K);var $=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0;window.addEventListener($?"pagehide":"unload",function(){s.close()})},J(q.server)},q.server.onmessage=function(N){r.log("Got this message from the websocket: "+N.data),R(JSON.parse(N.data)),J(q.server)},q.server.onclose=function(N){r.log("Lost connection to the gateway (is it down?)"+JSON.stringify(N)),P(),J(q.server)},q.server.onerror=function(N){r.error("AfricasTalking Client Error: Error connecting to the Africastalking WebSockets server... "+JSON.stringify(N)),H(N)}}));case 1:case"end":return L.stop()}},m)}),function(){var m=this,S=arguments;return new Promise(function(T,L){var J=l.apply(m,S);function H(re){ue(J,T,L,H,N,"next",re)}function N(re){ue(J,T,L,H,N,"throw",re)}H(void 0)})});return function(m,S){return C.apply(this,arguments)}}();function ve(l){if(r.log("Library initialized: "+l),r.log("Using WebSockets to contact Africastalking: "+l.server),l.capabilityToken===null||l.capabilityToken===void 0)return l.error("No capability token specified"),{};r.log({gatewayCallbacks:l});var C={server:l.server,capabilityToken:l.capabilityToken},m={setHandle:l.setHandle,emitEvent:l.emitEvent,destroyed:l.destroyed,error:l.error,oncleanup:l.oncleanup,onlocalstream:l.onlocalstream,onmessage:l.onmessage,onremotestream:l.onremotestream,consentDialog:function(){},mediaState:function(){},webrtcState:function(){},slowLink:function(){},iceState:function(){}};q(C,m).then(function(S){S.send(JSON.stringify({command:"create"}))}).catch(function(S){r.log("websocket Error: "+JSON.stringify(S))})}ve.noop=function(){},ve.isWebrtcSupported=function(){return window.RTCPeerConnection!==void 0&&window.RTCPeerConnection!==null&&navigator.getUserMedia!==void 0&&navigator.getUserMedia!==null};var ge=ve,ce={},fe=function(l){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(H){navigator.mediaDevices.enumerateDevices().then(H)});var C=[],m=location.protocol==="https:",S=!1;(typeof MediaStreamTrack<"u"&&"getSources"in MediaStreamTrack||navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)&&(S=!0);var T,L=!1,J=!1;T=function(){ce={audio:L,audioCap:J},r.log({supportedDevices:ce}),l()},r.log({"finding supported devices":navigator.enumerateDevices,"some if statememt":navigator.mediaDevices,navigator}),S?(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.enumerateDevices&&(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),navigator.enumerateDevices?(C=[],navigator.enumerateDevices(function(H){H.forEach(function(N){var re,K={};for(var $ in N)K[$]=N[$];K.kind==="audio"&&(K.kind="audioinput"),C.forEach(function(G){G.id===K.id&&G.kind===K.kind&&(re=!0)}),re||(K.deviceId||(K.deviceId=K.id),K.id||(K.id=K.deviceId),K.label?K.kind!=="audioinput"||J||(J=!0):(K.label="Please invoke getUserMedia once.",m||(K.label="HTTPs is required to get label of this "+K.kind+" device.")),K.kind==="audioinput"&&(L=!0),C.push(K))}),T&&T()})):T&&T()):r.log("cant enumerate devices")};function Ie(l,C){for(var m=0;m<C.length;m++){var S=C[m];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(l,S.key,S)}}function be(l,C){if(!(l instanceof C))throw new TypeError("Cannot call a class as a function")}function ke(l,C){for(var m=0;m<C.length;m++){var S=C[m];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(l,S.key,S)}}var V,te,De,Ce,he,Te,ye=new(function(){function l(){(function(S,T){if(!(S instanceof T))throw new TypeError("Cannot call a class as a function")})(this,l),this.events={}}var C,m;return C=l,(m=[{key:"subscribe",value:function(S,T){var L=this;return this.events[S]||(this.events[S]=[]),this.events[S].push(T),function(){L.events[S]=L.events[S].filter(function(J){return T!==J})}}},{key:"emit",value:function(S,T){var L=this.events[S];L&&L.forEach(function(J){J.call(null,T)})}},{key:"unsubscribe",value:function(S){var T=this.events[S];return this.events[S]||(this.events[S]=[]),T&&this.events.splice(T),this}},{key:"unsubscribeAll",value:function(){return this.events={},this}}])&&Ie(C.prototype,m),l}()),Pe=!1,Ge=function(){function l(S){var T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};be(this,l);var L=T.iceServers,J=L===void 0?[]:L,H=T.sounds,N=H===void 0?{}:H;this.token=S,this.initDone=!1,this.iceServers,this.atwebsocketUrl="wss://webrtc.africastalking.com/connect",Array.isArray(J)&&J.length>0&&(this.iceServers=Ve(J));var re=Je(N);he=new Audio(re.ringing),Te=new Audio(re.dialing),r.log({ringing:he,dialing:Te}),r.log({iceServers:this.iceServers}),Ue.bind(this)()}var C,m;return C=l,(m=[{key:"on",value:function(S,T){ye.subscribe(S,T)}},{key:"logout",value:function(){V&&V.send({message:{request:"unregister"}})}},{key:"hold",value:function(){V&&V.send({message:{request:"hold"}})}},{key:"unhold",value:function(){V&&V.send({message:{request:"unhold"}})}},{key:"call",value:function(S){Te.play();var T=this.iceServers;fe(function(){V.createOffer({iceServers:T,media:{audioSend:!0,audioRecv:!0},success:function(L){r.debug("Got SDP!"),r.debug(L),r.log({to:S,jsep:L});var J={request:"call",to:S};V.send({message:J,jsep:L}),Ce=S},error:function(L){r.error("AfricasTalking Client Error: ",L)}})})}},{key:"answer",value:function(){var S=this.iceServers;te=null,fe(function(){V.createAnswer({jsep:De,iceServers:S,media:{audio:!0},success:function(T){r.debug("Got SDP! audio=true, video="+!0),r.debug(T),V.send({message:{request:"accept"},jsep:T})},error:function(T){r.error("AfricasTalking Client Error: ",T),V.send({message:{request:"decline",code:480}})}})})}},{key:"dtmf",value:function(S){V.dtmf({dtmf:{tones:S}})}},{key:"muteAudio",value:function(){return V.muteAudio()}},{key:"unmuteAudio",value:function(){return V.unmuteAudio()}},{key:"getVolume",value:function(){return V.getVolume()}},{key:"isAudioMuted",value:function(){return V.isMuted()}},{key:"hangup",value:function(){te?Fe():(V.send({message:{request:"hangup"}}),V.hangup())}},{key:"getCounterpartNum",value:function(){return Ce}}])&&ke(C.prototype,m),l}();function Ue(){var l=document.getElementById("remote-stream-audio");V?Ae():this.initDone!==!0&&(r.log("creating remoteStreamAudio",l,he,Te),l||((l=document.createElement("audio")).id="remote-stream-audio",l.autoplay=!0,document.body.appendChild(l)),he.loop=!0,Te.loop=!0,this.initDone=!0,ge.isWebrtcSupported()?new ge({server:this.atwebsocketUrl,capabilityToken:this.token,setHandle:function(C){V=C,fe(function(){Ae()})},onmessage:function(C,m){r.log(" ::: Got a message :::"),r.log(JSON.stringify(C));var S=C.error;if(S==null||S==null){var T=C.result;if(r.log("This is the result "+T.toString),T!=null&&T.event!==void 0&&T.event!==null){var L=T.event;switch(L){case"registration_failed":return r.log("Registration failed: "+T.code+" "+T.reason),void Ae();case"registered":r.log("Successfully registered as "+T.username+"!"),Pe||(Pe=!0,ye.emit("ready"));break;case"unregistered":r.log("Successfully unregistered as "+T.username+"!"),Pe&&(Pe=!1,ye.emit("notready"));break;case"calling":r.log("Waiting for the peer to answer..."),ye.emit("calling");break;case"incomingcall":Ce=C.result.username.split("@")[0].split(":")[1],te=!0,he.play(),r.log("Incoming call from "+T.username+"!"),De=m,ye.emit("incomingcall",{from:Ce});break;case"progress":r.log("There's early media from "+T.username+", wairing for the call!"),m!=null&&je(m);break;case"missed_call":Ce=C.result.caller.split("@")[0].split(":")[1],r.log("Missed call from "+T.caller+"!"),ye.emit("missedcall",{from:Ce});break;case"accepted":Te.pause(),he.pause(),r.log(T.username+" accepted the call!"),m!=null&&je(m),ye.emit("callaccepted");break;case"hangup":te=null,Te.pause(),he.pause(),r.log("Call hung up ("+T.code+" "+T.reason+")!"),V.hangup(),ye.emit("hangup",{code:T.code,reason:T.reason});break;case"decline":te=null,Te.pause(),he.pause(),r.log("Call declined!"),V.hangup(),ye.emit("hangup");break;default:r.log("Received random json request "+L.toString)}}}else Pe?(Te.pause(),he.pause(),V.hangup()):r.log("User is not registered"+S)},emitEvent:function(C){ye.emit(C)},onlocalstream:function(C){r.log(" ::: Got a local stream :::"),r.log(JSON.stringify(C))},onremotestream:function(C){r.debug(" ::: Got a remote stream :::"),r.debug(JSON.stringify(C));var m=C.getAudioTracks();(function(S,T){h.a.browserDetails.browser==="chrome"?h.a.browserDetails.version>=43?S.srcObject=T:S.src!==void 0?S.src=URL.createObjectURL(T):r.error("AfricasTalking Client Error: Error attaching media stream to element"):S.srcObject=T})(l,new MediaStream(m))},oncleanup:function(){r.log(" ::: Got a cleanup notification :::")},error:function(C){Pe=!1,r.error("Africastalking Client Error: "+C),ye.unsubscribeAll()},destroyed:function(){Pe=!1,ye.unsubscribeAll()}}):r.error("AfricasTalking Client Error: No WebRTC support"))}var Ae=function(){V?(r.log({"loggin in with handle in client":V}),V.send({message:{request:"register"}})):r.error("Africastalking error: Unable to initialize")},Fe=function(){te=null,V.send({message:{request:"decline"}})},je=function(l){V.handleRemoteJsep({jsep:l,error:function(){V.send({message:{request:"hangup"}}),V.hangup()}})},Je=function(l){return{dialing:l.dialing?l.dialing:"https://res.cloudinary.com/at-voice/video/upload/v1558426588/AT-voice-client-sdk/dialing_g4tn6r.mp3",ringing:l.ringing?l.ringing:"https://res.cloudinary.com/at-voice/video/upload/v1558426103/AT-voice-client-sdk/ringing_au0d1x.mp3"}},Ve=function(l){var C=[];return l.forEach(function(m){if(typeof m.urls=="string"&&m.urls.startsWith("stun:"))C.push({urls:m.urls});else if(typeof m.urls=="string"&&(m.urls.startsWith("turn:")||m.urls.startsWith("turns:")))C.push({urls:m.urls,username:m.username,credential:m.credential});else if(Array.isArray(m.urls)){var S=m.urls.filter(function(T){return typeof T=="string"&&(T.startsWith("turn:")||T.startsWith("turns:"))});S.length===m.urls.length?C.push({urls:S,username:m.username,credential:m.credential}):r.error("AfricasTalking Client Error: Invalid iceServer param ".concat(JSON.stringify(m)))}else r.error("AfricasTalking Client Error: Invalid iceServer param ".concat(JSON.stringify(m)))}),C},ze=Ge;Y.default={Client:ze}}]).default})})(Ne);var Ke=Ne.exports;const we=We(Ke),Re={sounds:{}},$e={components:{clientEdit:qe},data:()=>({text:"Updated",snackbar:!1,dialog:!1,group:null,call_inprogress:!1,client:{},token:"ATCAPtkn_be042b9275efb35c92aa999f014d9911c3383a68ea488276936a4a00da601528"}),watch:{group(){this.dialog=!1}},methods:{openEdit(){this.$refs.clientModal.show(this.client)},show(A){this.client=A.client,this.dialog=!0},hide(){this.dialog=!1},transfer(){},toggleAudio(A){var Z=document.getElementById("audio-player");A?Z.play():Z.pause()},toggleDialer(A){var Z=document.getElementById("audio-dialing");A?Z.play():Z.pause()},incomingCall(A){this.toggleAudio(!0),eventBus.$emit("incomingEvent",A)},getLeads(){var A={update:"updateLeads",model:"leads"};this.$store.dispatch("getItems",A)},makeCall(){this.call_inprogress=!0,this.toggleDialer(!0),new we.Client(this.token,Re).call(this.client.phone)},answer(){new we.Client(this.token,Re).answer()},hangup(){new we.Client(this.token,Re).hangup()},muteAudio(){new we.Client(this.token,Re).muteAudio()},unmuteAudio(){new we.Client(this.token,Re).unmuteAudio()},hold(){new we.Client(this.token,Re).hold()},unhold(){new we.Client(this.token,Re).unhold()},getStats(){var A={model:"agent_data",update:"updateAgentData"};this.$store.dispatch("getItems",A)}},created(){const A=new we.Client(this.token,Re);A.on("incomingcall",Z=>{this.snackbar=!0,this.text="Incomming call ...",this.call_inprogress=!0;var j={call_status:!0};axios.post("agent_active/"+id,j),this.incomingCall(Z)},!1),A.on("ready",Z=>{console.log("User is ready")},!1),A.on("notready",()=>{console.log("User is not ready")},!1),A.on("closed",Z=>{console.log(Z),console.log("Connection closed")},!1),A.on("callaccepted",Z=>{this.snackbar=!0,this.text="Call received ...",this.call_inprogress=!0,this.toggleAudio(!1),this.toggleDialer(!1),eventBus.$emit("alertRequest","Call received")},!1),A.on("hangup",Z=>{console.log("🚀 ~ file: calls.vue:270 ~ created ~ hangupCause:",Z),this.snackbar=!0,this.text="Hanged up: "+Z.reason,this.call_inprogress=!1,this.toggleDialer(!1),this.toggleAudio(!1)},!1),A.on("calling",Z=>{this.snackbar=!0,this.text="Calling ...",this.call_inprogress=!0},!1)}},Ye=Le("audio",{id:"audio-player"},[Le("source",{src:"/audio/ring.mp3",type:"audio/mpeg"})],-1),Xe=Le("audio",{id:"audio-dialing"},[Le("source",{src:"/audio/outgoing.mp3",type:"audio/mpeg"})],-1);function Qe(A,Z,j,Y,_,u){const n=oe("v-icon"),o=oe("v-btn"),e=oe("v-toolbar-title"),c=oe("v-spacer"),d=oe("v-toolbar"),r=oe("v-card-title"),g=oe("v-list-subheader"),h=oe("v-list-item-title"),v=oe("v-list-item"),s=oe("v-list"),f=oe("v-card-text"),t=oe("v-divider"),i=oe("v-card-actions"),a=oe("v-card"),p=oe("v-dialog"),y=oe("clientEdit"),R=oe("v-snackbar"),b=oe("v-row");return Ee(),_e(b,{justify:"center"},{default:U(()=>[z(p,{modelValue:A.dialog,"onUpdate:modelValue":Z[1]||(Z[1]=E=>A.dialog=E),persistent:"",width:"600"},{default:U(()=>[z(a,null,{default:U(()=>[z(r,{class:"text-h5"},{default:U(()=>[z(d,{density:"compact"},{default:U(()=>[z(o,{icon:""},{default:U(()=>[z(n,null,{default:U(()=>[ee("mdi-check")]),_:1})]),_:1}),z(e,null,{default:U(()=>[ee(Me(A.client.phone),1)]),_:1}),z(c),z(o,{icon:"",onClick:u.openEdit},{default:U(()=>[z(n,null,{default:U(()=>[ee("mdi-pen")]),_:1})]),_:1},8,["onClick"]),z(o,{icon:"",onClick:Z[0]||(Z[0]=E=>A.dialog=!1)},{default:U(()=>[z(n,null,{default:U(()=>[ee("mdi-close")]),_:1})]),_:1})]),_:1})]),_:1}),z(f,null,{default:U(()=>[z(s,{density:"compact"},{default:U(()=>[z(g,null,{default:U(()=>[ee("REPORTS")]),_:1}),z(v,{color:"primary"},{prepend:U(()=>[z(n,null,{default:U(()=>[ee("mdi-account-box")]),_:1})]),default:U(()=>[z(h,null,{default:U(()=>[ee(Me(A.client.name),1)]),_:1})]),_:1}),z(v,{color:"primary"},{prepend:U(()=>[z(n,null,{default:U(()=>[ee("mdi-email")]),_:1})]),default:U(()=>[z(h,null,{default:U(()=>[ee(Me(A.client.email),1)]),_:1})]),_:1}),z(v,{color:"primary"},{prepend:U(()=>[z(n,null,{default:U(()=>[ee("mdi-calendar-range")]),_:1})]),default:U(()=>[z(h,null,{default:U(()=>[ee(Me(A.client.created_at),1)]),_:1})]),_:1})]),_:1})]),_:1}),z(t),z(i,null,{default:U(()=>[A.call_inprogress?(Ee(),_e(o,{key:0,color:"red-darken-1",variant:"text",onClick:u.hangup},{default:U(()=>[z(n,null,{default:U(()=>[ee("mdi-phone-hangup")]),_:1}),ee(" Hangup ")]),_:1},8,["onClick"])):Oe("",!0),A.call_inprogress?(Ee(),_e(o,{key:1,color:"warning",variant:"text",onClick:u.hold},{default:U(()=>[z(n,null,{default:U(()=>[ee("mdi-phone-paused")]),_:1}),ee(" Hold ")]),_:1},8,["onClick"])):Oe("",!0),A.call_inprogress?(Ee(),_e(o,{key:2,color:"warning",variant:"text",onClick:u.unhold},{default:U(()=>[z(n,null,{default:U(()=>[ee("mdi-phone-sync")]),_:1}),ee(" Resume ")]),_:1},8,["onClick"])):Oe("",!0),z(c),A.call_inprogress?(Ee(),_e(o,{key:3,color:"info",variant:"text",onClick:u.transfer},{default:U(()=>[z(n,null,{default:U(()=>[ee("mdi-phone-forward")]),_:1}),ee(" Transfer ")]),_:1},8,["onClick"])):Oe("",!0),A.call_inprogress?Oe("",!0):(Ee(),_e(o,{key:4,color:"green-darken-1",variant:"text",onClick:u.makeCall},{default:U(()=>[z(n,null,{default:U(()=>[ee("mdi-phone-in-talk")]),_:1}),ee(" Call ")]),_:1},8,["onClick"]))]),_:1})]),_:1})]),_:1},8,["modelValue"]),Ye,Xe,z(y,{ref:"clientModal"},null,512),z(R,{modelValue:A.snackbar,"onUpdate:modelValue":Z[2]||(Z[2]=E=>A.snackbar=E)},{default:U(()=>[ee(Me(A.text),1)]),_:1},8,["modelValue"])]),_:1})}const nt=He($e,[["render",Qe]]);export{nt as default};
